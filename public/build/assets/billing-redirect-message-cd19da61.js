import{bm as k,bl as A,r as l,b6 as M,u as B,Y as y,j as n,c as C,B as N,L as o,A as D,o as I,ab as R,cp as F,T as w,a1 as z}from"./main-0832b2fb.js";import{T as V}from"./TaskAlt-5bad8dad.js";var L="https://js.stripe.com/v3",W=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,E="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",q=function(){for(var e=document.querySelectorAll('script[src^="'.concat(L,'"]')),t=0;t<e.length;t++){var s=e[t];if(W.test(s.src))return s}return null},G=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",s=document.createElement("script");s.src="".concat(L).concat(t);var a=document.head||document.body;if(!a)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return a.appendChild(s),s},U=function(e,t){!e||!e._registerWrapper||e._registerWrapper({name:"stripe-js",version:"1.49.0",startTime:t})},b=null,X=function(e){return b!==null||(b=new Promise(function(t,s){if(typeof window>"u"||typeof document>"u"){t(null);return}if(window.Stripe&&e&&console.warn(E),window.Stripe){t(window.Stripe);return}try{var a=q();a&&e?console.warn(E):a||(a=G(e)),a.addEventListener("load",function(){window.Stripe?t(window.Stripe):s(new Error("Stripe.js not available"))}),a.addEventListener("error",function(){s(new Error("Failed to load Stripe.js"))})}catch(i){s(i);return}})),b},$=function(e,t,s){if(e===null)return null;var a=e.apply(void 0,t);return U(a,s),a},P=Promise.resolve().then(function(){return X(null)}),T=!1;P.catch(function(r){T||console.warn(r)});var O=function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];T=!0;var a=Date.now();return P.then(function(i){return $(i,t,a)})};function Y({type:r,productId:e}){const{user:t}=k(),s=A(),a=l.useRef(!1),i=l.useRef(null),{localeCode:x}=M(),[u,S]=l.useState(null),[j,h]=l.useState(null),{branding:{site_name:m},billing:{stripe_public_key:c,stripe:{enable:d}}}=B();return l.useEffect(()=>{!d||!c||a.current||(Promise.all([O(c,{apiVersion:"2022-08-01",locale:x}),r==="setupIntent"?H():J(e)]).then(([p,{clientSecret:v}])=>{if(p&&i.current){const f=p.elements({clientSecret:v,appearance:{theme:s?"night":"stripe"}});f.create("payment",{business:{name:m},terms:{card:"never"},defaultValues:{billingDetails:{email:t==null?void 0:t.email}}}).mount(i.current),S(p),h(f)}}),a.current=!0)},[e,c,d,s,x,m,r,t==null?void 0:t.email]),{stripe:u,elements:j,paymentElementRef:i,stripeIsEnabled:c!=null&&d}}function H(){return y.post("billing/stripe/create-setup-intent").then(r=>r.data)}function J(r){return y.post("billing/stripe/create-partial-subscription",{product_id:r}).then(e=>e.data)}function te({productId:r,type:e="subscription",submitLabel:t,returnUrl:s}){const{stripe:a,elements:i,paymentElementRef:x,stripeIsEnabled:u}=Y({type:e,productId:r}),[S,j]=l.useState(null),[h,m]=l.useState(!1),c=!u||i!=null&&a!=null,d=async p=>{var v,f;if(p.preventDefault(),!(!a||!i)){m(!0);try{const g=await a[e==="subscription"?"confirmPayment":"confirmSetup"]({elements:i,confirmParams:{return_url:s}});((v=g.error)==null?void 0:v.type)!=="validation_error"&&((f=g.error)!=null&&f.message)&&j(g.error.message)}catch{}m(!1)}};return n.jsxs("form",{onSubmit:d,children:[n.jsx("div",{ref:x,className:C("min-h-[303px]",!u&&"hidden"),children:u&&n.jsx(K,{})}),S&&!h&&n.jsx("div",{className:"text-danger mt-20",children:S}),n.jsx(N,{variant:"flat",color:"primary",size:"md",className:"w-full mt-40",type:"submit",disabled:h||!c,children:t})]})}function K(){return n.jsxs(l.Fragment,{children:[n.jsx(o,{className:"h-30 mb-20"}),n.jsx(o,{className:"h-30 mb-20"}),n.jsx(o,{className:"h-30 mb-20"}),n.jsx(o,{className:"h-30"})]})}function ne({config:r}){return n.jsx(D,{initial:!1,mode:"wait",children:n.jsx("div",{className:"mt-80",children:r?n.jsxs(I.div,{className:"text-center",...R,children:[r.status==="success"?n.jsx(V,{className:"text-positive text-6xl"}):n.jsx(F,{className:"text-danger text-6xl"}),n.jsx("div",{className:"text-2xl font-semibold mt-30",children:n.jsx(w,{...r.message})}),n.jsx(N,{variant:"flat",color:"primary",className:"w-full mt-30",size:"md",elementType:z,to:r.link,children:n.jsx(w,{...r.buttonLabel})})]},"payment-status"):n.jsx(Q,{},"loading-skeleton")})})}function Q(){return n.jsxs(I.div,{className:"text-center max-w-280",...R,children:[n.jsx(o,{size:"w-50 h-50",variant:"rect"}),n.jsx(o,{className:"text-2xl mt-30"}),n.jsx(o,{size:"h-42",className:"mt-30"})]},"loading-skeleton")}export{ne as B,te as S,O as l};
//# sourceMappingURL=billing-redirect-message-cd19da61.js.map
