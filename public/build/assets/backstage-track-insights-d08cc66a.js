import{bv as ge,bY as Gt,bZ as Ks,m as I,b_ as Re,b$ as Kt,c0 as Fs,c1 as Vs,a as Z,j as s,R as Be,c as P,l as Qt,ak as cs,aL as Qs,aM as Zs,aN as Ys,$ as ke,c2 as Zt,c3 as Yt,c4 as ds,r as u,c5 as K,k as qe,c6 as ss,c7 as ts,c8 as fe,c9 as je,ca as Le,cb as ze,cc as Js,b as ae,b7 as ne,n as We,cd as X,ce as Jt,cf as Xt,cg as ea,ch as sa,ci as ta,cj as aa,ck as na,o as ee,I as B,u as oe,aH as Xs,cl as et,cm as ra,ac as ia,ad as la,T as d,t as us,J as Ge,E as $,v as we,x as Ne,A as Ke,ao as re,Z as z,d as ms,p as O,S as oa,i as xs,P as fs,a7 as be,L as he,a5 as st,cn as ca,co as da,cp as ua,cq as ma,au as hs,K as xa,cr as fa,bX as ha,e as Ue,D as se,z as Ie,w as ps,aJ as Ms,Q as pa,cs as M,aq as ga,ct as ja,aZ as ba,cu as va,M as gs,V as ce,Y as ya,ba as Rs,bb as ka,X as te,cv as wa,cw as Na,ag as Qe,a9 as Ze,q as L,W as de,a2 as Ce,y as ie,ax as De,ap as ue,at as me,a_ as js,as as bs,a8 as tt,a0 as at,a1 as nt,_ as rt,a3 as J,aA as it,G as Ia,bu as Ca,bt as Da,N as lt,cx as ot,f as Sa,aw as Ye,a6 as Pa,by as Aa,af as Ta,aI as $a,cy as Fa,bE as Va,bF as Ls,b1 as ct,b5 as Ma,b2 as dt,U as Ra}from"./main-1406e08c.js";import{K as La,a as za,a0 as Ua,A as vs,C as ut,a2 as Ea,k as mt,G as ys,q as _a,y as Ee,Z as xt,J as Oa,z as _e,D as Ha,b as ks,u as Ba,Y as ft,E as qa,O as ht,r as Je,o as ws,H as Xe,x as Wa,a3 as Ga,S as Ka,j as Qa,R as Za,T as Ya,s as Ns,F as Oe,I as Ja,c as Xa,e as en,f as sn,g as Te,h as tn,i as $e,_ as an,V as pt,B as nn,t as zs,P as rn,U as ln,p as gt}from"./play-arrow-filled-8e87b0ae.js";import{E as Is}from"./Edit-4fa321e0.js";function jt(e){return e.set({hour:0,minute:0,second:0,millisecond:0})}function H(e){return e.set({hour:24-1,minute:60-1,second:60-1,millisecond:1e3-1})}function on(){var a;const e=ge().settings.dates.default_timezone,t=((a=ge().user)==null?void 0:a.timezone)||e||"auto";return!t||t==="auto"?Gt():t}const T=jt(Ks(on()));var Gs;const as=((Gs=ge().i18n)==null?void 0:Gs.language)||"en",bt=[{key:0,label:I("Today"),getRangeValue:()=>({preset:0,start:T,end:H(T)})},{key:1,label:I("Yesterday"),getRangeValue:()=>({preset:1,start:T.subtract({days:1}),end:H(T).subtract({days:1})})},{key:2,label:I("This week"),getRangeValue:()=>({preset:2,start:Re(T,as),end:Kt(H(T),as)})},{key:3,label:I("Last week"),getRangeValue:()=>{const e=Re(T,as).subtract({days:7});return{preset:3,start:e,end:e.add({days:6})}}},{key:4,label:I("Last 7 days"),getRangeValue:()=>({preset:4,start:T.subtract({days:7}),end:H(T)})},{key:5,label:I("Last 14 days"),getRangeValue:()=>({preset:5,start:T.subtract({days:14}),end:H(T)})},{key:6,label:I("Last 30 days"),getRangeValue:()=>({preset:6,start:T.subtract({days:30}),end:H(T)})},{key:7,label:I("Last 3 months"),getRangeValue:()=>({preset:7,start:T.subtract({months:3}),end:H(T)})},{key:8,label:I("Last 12 months"),getRangeValue:()=>({preset:8,start:T.subtract({months:12}),end:H(T)})},{key:9,label:I("This year"),getRangeValue:()=>({preset:9,start:Fs(T),end:Vs(H(T))})},{key:10,label:I("Last year"),getRangeValue:()=>({preset:10,start:Fs(T).subtract({years:1}),end:Vs(H(T)).subtract({years:1})})}],vt=Z(s.jsx("path",{d:"M7 11h2v2H7v-2zm14-5v14c0 1.1-.9 2-2 2H5c-1.11 0-2-.9-2-2l.01-14c0-1.1.88-2 1.99-2h1V2h2v2h8V2h2v2h1c1.1 0 2 .9 2 2zM5 8h14V6H5v2zm14 12V10H5v10h14zm-4-7h2v-2h-2v2zm-4 0h2v-2h-2v2z"}),"DateRangeOutlined"),yt=Be.forwardRef((e,t)=>{const{children:a,inputProps:n,wrapperProps:r,className:i,autoFocus:o,style:l,onClick:c}=e;return s.jsx("div",{...r,onClick:c,children:s.jsx("div",{...n,role:"group",className:P(i,"flex items-center focus-within:ring focus-within:ring-primary/focus focus-within:border-primary/60"),ref:t,style:l,children:s.jsx(Qt,{autoFocus:o,children:a})})})}),kt=Be.forwardRef(({inputRef:e,wrapperProps:t,children:a,onBlur:n,...r},i)=>{const o=cs(r),l=Qs(i),{fieldProps:c,inputProps:f}=Zs({...r,focusRef:l,labelElementType:"span"});return o.wrapper=P(o.wrapper,r.disabled&&"pointer-events-none"),s.jsx(Ys,{wrapperProps:ke(t,{onBlur:m=>{l.current.contains(m.relatedTarget)||n==null||n(m)},onClick:()=>{Zt(l).focusFirst()}}),fieldClassNames:o,ref:l,...c,children:s.jsx(yt,{inputProps:f,className:P(o.input,"gap-10"),ref:e,children:a})})});function cn(e){return e instanceof Yt?"day":"minute"}function is(e,t,a){return t!=null&&e.compare(t)<0||a!=null&&e.compare(a)>0}function wt(e,t){const a=ds(),[n,r]=u.useState(!1),i=t.closeDialogOnSelection??!0,o=t.granularity||cn(e),l=t.min?K(t.min,a):void 0,c=t.max?K(t.max,a):void 0;return{timezone:a,granularity:o,min:l,max:c,calendarIsOpen:n,setCalendarIsOpen:r,closeDialogOnSelection:i}}function Se(){const e=ds();return u.useMemo(()=>Ks(e),[e])}function dn(e){var Y,w;const t=Se(),[a,n]=u.useState({start:(!e.value||!e.value.start)&&!((Y=e.defaultValue)!=null&&Y.start),end:(!e.value||!e.value.end)&&!((w=e.defaultValue)!=null&&w.end)}),r=e.onChange,[i,o]=qe(e.value?rs(e.value,t):void 0,e.value?void 0:rs(e.defaultValue,t),e.onChange),{min:l,max:c,granularity:f,timezone:m,calendarIsOpen:p,setCalendarIsOpen:h,closeDialogOnSelection:x}=wt(i.start,e),g=u.useCallback(()=>{n({start:!0,end:!0}),o(rs(null,t)),r==null||r(null),h(!1)},[t,o,r,h]),[b,v]=u.useState(null),[k,N]=u.useState(!1),[S,C]=u.useState(i),[R,U]=u.useState(()=>Us(i,c)),j=u.useCallback(y=>{let A=y.start,V=y.end;l&&(A=ss(A,l));const W=c?ts(c,V):V;A=ts(A,W);const Wt=l?ss(l,A):A;return V=ss(V,Wt),c&&(V=ts(V,c)),{start:K(A,m),end:K(V,m)}},[l,c,m]),D=u.useCallback(y=>{const A={...j(y),preset:y.preset};o(A),C(A),U(Us(A,c)),n({start:!1,end:!1})},[o,j,c]),F=u.useCallback(y=>!a.start&&fe(y,S.start)||!a.end&&fe(y,S.end),[S,a]),E=u.useCallback(y=>(k||!a.start&&!a.end)&&y.compare(S.start)>=0&&y.compare(S.end)<=0,[S,a,k]),q=u.useCallback(y=>fe(y,S.start),[S]),G=u.useCallback(y=>fe(y,S.end),[S]),le=u.useCallback((y,A)=>({onPointerEnter:()=>{k&&A&&C(ns({start:b,end:y,timezone:m}))},onClick:()=>{if(!k)N(!0),v(y),C(ns({start:y,end:y,timezone:m}));else{const V=ns({start:jt(K(b,m)),end:H(K(y,m)),timezone:m});N(!1),v(null),D==null||D(V),x&&(h==null||h(!1))}}}),[b,k,D,h,x,m]);return{selectedValue:i,setSelectedValue:D,calendarIsOpen:p,setCalendarIsOpen:h,dayIsActive:F,dayIsHighlighted:E,dayIsRangeStart:q,dayIsRangeEnd:G,getCellProps:le,calendarDates:R,setIsPlaceholder:n,isPlaceholder:a,clear:g,setCalendarDates:U,min:l,max:c,granularity:f,timezone:m,closeDialogOnSelection:x}}function Us(e,t){let a=je(Le(e.start)),n=je(ze(e.end));return Js(a,n)&&(n=ze(n.add({months:1}))),t&&n.compare(t)>0&&(n=a,a=Le(a.subtract({months:1}))),[a,n]}function ns(e){const t=K(e.start,e.timezone),a=K(e.end,e.timezone);return t.compare(a)>0?{start:a,end:t}:{start:t,end:a}}function rs(e,t){return e!=null&&e.start&&(e!=null&&e.end)?e:!(e!=null&&e.start)&&(e!=null&&e.end)?(e.start=e.end.subtract({months:1}),e):!(e!=null&&e.end)&&(e!=null&&e.start)?(e.end=e.start.add({months:1}),e):{start:t,end:t.add({months:1})}}const un=Z(s.jsx("path",{d:"M16.01 11H4v2h12.01v3L20 12l-3.99-4v3z"}),"ArrowRightAltOutlined");function mn(e,t,a,n){switch(t){case"era":case"year":case"month":case"day":return e.cycle(t,a,{round:t==="year"})}if("hour"in e)switch(t){case"dayPeriod":{const r=e.hour,i=r>=12;return e.set({hour:i?r-12:r+12})}case"hour":case"minute":case"second":return e.cycle(t,a,{round:t!=="hour",hourCycle:n.hour12?12:24})}return e}function xn(e,t,a,n){switch(t){case"day":case"month":case"year":return e.set({[t]:a})}if("hour"in e)switch(t){case"dayPeriod":{const r=e.hour,i=r>=12;return a>=12===i?e:e.set({hour:i?r-12:r+12})}case"hour":if(n.hour12){const i=e.hour>=12;!i&&a===12&&(a=0),i&&a<12&&(a+=12)}case"minute":case"second":return e.set({[t]:a})}return e}const Es={year:5,month:2,day:7,hour:2,minute:15,second:15,dayPeriod:1};function fn({segment:e,domProps:t,value:a,onChange:n,isPlaceholder:r,state:{timezone:i,calendarIsOpen:o,setCalendarIsOpen:l}}){const c=ae(),f=u.useRef(""),{localeCode:m}=ne(),p=We(),h=X({timeZone:i}),x=u.useMemo(()=>new Jt(m,{maximumFractionDigits:0}),[m]),g=j=>{n(xn(a,e.type,j,h.resolvedOptions()))},b=j=>{n(mn(a,e.type,j,h.resolvedOptions()))},v=()=>{if(x.isValidPartialNumber(e.text)){const j=e.text.slice(0,-1),D=x.parse(j);if(j.length===0||D===0){const F=Xt(i);e.type in F&&g(F[e.type])}else g(D);f.current=j}else e.type==="dayPeriod"&&b(-1)},k=j=>{var D;if(!(j.ctrlKey||j.metaKey||j.shiftKey||j.altKey)){switch(j.key){case"ArrowLeft":j.preventDefault(),j.stopPropagation(),p.focusPrevious();break;case"ArrowRight":j.preventDefault(),j.stopPropagation(),p.focusNext();break;case"Enter":(D=j.target.closest("form"))==null||D.requestSubmit(),l(!o);break;case"Tab":break;case"Backspace":case"Delete":{j.preventDefault(),j.stopPropagation(),v();break}case"ArrowUp":j.preventDefault(),f.current="",b(1);break;case"ArrowDown":j.preventDefault(),f.current="",b(-1);break;case"PageUp":j.preventDefault(),f.current="",b(Es[e.type]||1);break;case"PageDown":j.preventDefault(),f.current="",b(-(Es[e.type]||1));break;case"Home":j.preventDefault(),f.current="",g(e.maxValue);break;case"End":j.preventDefault(),f.current="",g(e.minValue);break}R(j.key)}},N=X({hour:"numeric",hour12:!0}),S=u.useMemo(()=>{const j=new Date;return j.setHours(0),N.formatToParts(j).find(D=>D.type==="dayPeriod").value},[N]),C=u.useMemo(()=>{const j=new Date;return j.setHours(12),N.formatToParts(j).find(D=>D.type==="dayPeriod").value},[N]),R=j=>{const D=f.current+j;switch(e.type){case"dayPeriod":if(S.toLowerCase().startsWith(j))g(0);else if(C.toLowerCase().startsWith(j))g(12);else break;p.focusNext();break;case"day":case"hour":case"minute":case"second":case"month":case"year":{if(!x.isValidPartialNumber(D))return;let F=x.parse(D),E=F,q=e.minValue===0;if(e.type==="hour"&&h.resolvedOptions().hour12){switch(h.resolvedOptions().hourCycle){case"h11":F>11&&(E=x.parse(j));break;case"h12":q=!1,F>12&&(E=x.parse(j));break}e.value>=12&&F>1&&(F+=12)}else F>e.maxValue&&(E=x.parse(j));if(Number.isNaN(F))return;const G=E!==0||q;G&&g(E),+`${F}0`>e.maxValue||D.length>=String(e.maxValue).length?(f.current="",G&&p.focusNext()):f.current=D;break}}},U=c?{}:{"aria-label":e.type,"aria-valuetext":r?void 0:`${e.value}`,"aria-valuemin":e.minValue,"aria-valuemax":e.maxValue,"aria-valuenow":r?void 0:e.value,tabIndex:0,onKeyDown:k};return s.jsx("div",{...ke(t,{...U,onFocus:j=>{f.current="",j.target.scrollIntoView({block:"nearest"})},onClick:j=>{j.preventDefault(),j.stopPropagation()}}),className:"p-2 outline-none caret-transparent cursor-default rounded focus:bg-primary focus:text-on-primary select-none whitespace-nowrap box-content tabular-nums text-center",children:e.text.padStart(e.minLength,"0")})}function hn({segment:e,domProps:t}){const a=We();return s.jsx("div",{...t,onPointerDown:n=>{n.pointerType==="mouse"&&(n.preventDefault(),a.focusNext({from:n.target})||a.focusPrevious({from:n.target}))},"aria-hidden":!0,className:"min-w-4 cursor-default select-none",children:e.text})}function pn(e,t,a){switch(t){case"year":return{value:e.year,placeholder:"yyyy",minValue:1,maxValue:e.calendar.getYearsInEra(e)};case"month":return{value:e.month,placeholder:"mm",minValue:sa(e),maxValue:e.calendar.getMonthsInYear(e)};case"day":return{value:e.day,minValue:ea(e),maxValue:e.calendar.getDaysInMonth(e),placeholder:"dd"}}if("hour"in e)switch(t){case"dayPeriod":return{value:e.hour>=12?12:0,minValue:0,maxValue:12,placeholder:"--"};case"hour":if(a.hour12){const n=e.hour>=12;return{value:e.hour,minValue:n?12:0,maxValue:n?23:11,placeholder:"--"}}return{value:e.hour,minValue:0,maxValue:23,placeholder:"--"};case"minute":return{value:e.minute,minValue:0,maxValue:59,placeholder:"--"}}return{}}function ls({segmentProps:e,state:t,value:a,onChange:n,isPlaceholder:r}){const{granularity:i}=t,o=u.useMemo(()=>{const m={year:"numeric",month:"numeric",day:"numeric"};return i==="minute"&&(m.hour="numeric",m.minute="numeric"),m},[i]),l=X(o),c=u.useMemo(()=>a.toDate(),[a]),f=u.useMemo(()=>l.formatToParts(c).map(m=>{const p=pn(a,m.type,l.resolvedOptions()),h=r&&m.type!=="literal"?p.placeholder:m.value;return{type:m.type,text:m.value===", "?" ":h,...p,minLength:m.type!=="literal"?String(p.maxValue).length:1}}),[c,l,r,a]);return s.jsx("div",{className:"flex items-center",children:f.map((m,p)=>m.type==="literal"?s.jsx(hn,{domProps:e,segment:m},p):s.jsx(fn,{isPlaceholder:r,domProps:e,state:t,value:a,onChange:n,segment:m},p))})}function gn({date:e,currentMonth:t,state:{dayIsActive:a,dayIsHighlighted:n,dayIsRangeStart:r,dayIsRangeEnd:i,getCellProps:o,timezone:l,min:c,max:f}}){const{localeCode:m}=ne(),p=ta(e,m),h=a(e),x=n(e),g=r(e),b=i(e),v=aa(e,l),k=Js(e,t),N=is(e,c,f);return s.jsxs("div",{role:"button","aria-disabled":N,className:P("w-40 h-40 text-sm relative isolate flex-shrink-0",N&&"text-disabled pointer-events-none",!k&&"invisible pointer-events-none"),...o(e,k),children:[s.jsx("span",{className:P("absolute inset-0 flex items-center justify-center rounded-full w-full h-full select-none z-10 cursor-pointer",!h&&!v&&"hover:bg-hover",h&&"bg-primary text-on-primary font-semibold",v&&!h&&"bg-chip"),children:e.day}),x&&k&&s.jsx("span",{className:P("absolute w-full h-full inset-0 bg-primary/focus",(g||p===0||e.day===1)&&"rounded-l-full",(b||p===6||e.day===t.calendar.getDaysInMonth(t))&&"rounded-r-full")})]})}function jn({startDate:e,state:t,isFirst:a,isLast:n}){const{localeCode:r}=ne(),i=na(e,r),o=Re(e,r);return s.jsxs("div",{className:"w-280 flex-shrink-0",children:[s.jsx(bn,{isFirst:a,isLast:n,state:t,currentMonth:e}),s.jsxs("div",{className:"block",role:"grid",children:[s.jsx(vn,{state:t,startDate:e}),[...new Array(i).keys()].map(l=>s.jsx(ee.div,{className:"flex mb-6",children:[...new Array(7).keys()].map(c=>s.jsx(gn,{date:o.add({weeks:l,days:c}),currentMonth:e,state:t},c))},l))]})]})}function bn({currentMonth:e,isFirst:t,isLast:a,state:{calendarDates:n,setCalendarDates:r,timezone:i,min:o,max:l}}){const c=h=>{const x=n.length;let g;h==="forward"?g=n.map(b=>ze(b.add({months:x}))):g=n.map(b=>ze(b.subtract({months:x}))),r(g)},f=X({month:"long",year:"numeric",era:e.calendar.identifier!=="gregory"?"long":void 0,calendar:e.calendar.identifier}),m=is(e.subtract({days:1}),o,l),p=is(Le(e.add({months:1})),o,l);return s.jsxs("div",{className:"flex items-center justify-between gap-10",children:[s.jsx(B,{size:"md",className:P("text-muted",!t&&"invisible"),disabled:!t||m,"aria-hidden":!t,onClick:()=>{c("backward")},children:s.jsx(La,{})}),s.jsx("div",{className:"text-sm font-semibold select-none",children:f.format(e.toDate(i))}),s.jsx(B,{size:"md",className:P("text-muted",!a&&"invisible"),disabled:!a||p,"aria-hidden":!a,onClick:()=>{c("forward")},children:s.jsx(za,{})})]})}function vn({state:{timezone:e},startDate:t}){const{localeCode:a}=ne(),n=X({weekday:"short"}),r=Re(t,a);return s.jsx("div",{className:"flex",children:[...new Array(7).keys()].map(i=>{const l=r.add({days:i}).toDate(e),c=n.format(l);return s.jsx("div",{className:"w-40 h-40 text-sm font-semibold relative flex-shrink-0",children:s.jsx("div",{className:"absolute flex items-center justify-center w-full h-full select-none",children:c})},i)})})}function Nt({state:e,visibleMonths:t=1}){return ae()&&(t=1),s.jsx(u.Fragment,{children:[...new Array(t).keys()].map(n=>{const r=je(Le(e.calendarDates[n])),i=n===0,o=n===t-1;return s.jsx(jn,{state:e,startDate:r,isFirst:i,isLast:o},n)})})}const It=u.memo(({start:e,end:t,options:a,preset:n})=>{const{dates:r}=oe(),i=ds(),o=X(a||Xs[n||(r==null?void 0:r.format)]);if(!e||!t)return null;let l;try{l=o.formatRange(_s(e,i),_s(t,i))}catch{l=""}return s.jsx(u.Fragment,{children:l})},et);function _s(e,t){return typeof e=="string"?ra(e,t).toDate():"toDate"in e?e.toDate(t):e}function yn({onPresetSelected:e,selectedValue:t}){return s.jsx(ia,{className:"min-w-192",padding:"py-14",dataTestId:"date-range-preset-list",children:bt.map(a=>s.jsx(la,{borderRadius:"rounded-none",capitalizeFirst:!0,isSelected:(t==null?void 0:t.preset)===a.key,onSelected:()=>{const n=a.getRangeValue();e(n)},children:s.jsx(d,{...a.label})},a.key))})}function kn({state:e,showInlineDatePickerField:t=!1}){const a=Ua(),{close:n}=us(),r=u.useRef(e),i=e.isPlaceholder.start||e.isPlaceholder.end,o=s.jsxs(Ge,{dividerTop:!0,startAction:!i&&!a?s.jsx("div",{className:"text-xs",children:s.jsx(It,{start:e.selectedValue.start.toDate(),end:e.selectedValue.end.toDate(),options:{dateStyle:"medium"}})}):void 0,children:[s.jsx($,{variant:"text",size:"xs",onClick:()=>{e.setSelectedValue(r.current.selectedValue),e.setIsPlaceholder(r.current.isPlaceholder),n()},children:s.jsx(d,{message:"Cancel"})}),s.jsx($,{variant:"flat",color:"primary",size:"xs",onClick:()=>{n(e.selectedValue)},children:s.jsx(d,{message:"Select"})})]});return s.jsxs(we,{size:"auto",children:[s.jsxs(Ne,{className:"flex",padding:"p-0",children:[!a&&s.jsx(yn,{selectedValue:e.selectedValue,onPresetSelected:l=>{e.setSelectedValue(l),e.closeDialogOnSelection&&n(l)}}),s.jsx(Ke,{initial:!1,children:s.jsx(wn,{state:e,showInlineDatePickerField:t})})]}),!e.closeDialogOnSelection&&o]})}function wn({state:e,showInlineDatePickerField:t}){return s.jsxs(ee.div,{initial:{width:0,overflow:"hidden"},animate:{width:"auto"},exit:{width:0,overflow:"hidden"},transition:{type:"tween",duration:.125},className:"border-l px-20 pt-10 pb-20",children:[t&&s.jsx(Nn,{state:e}),s.jsx("div",{className:"flex items-start gap-36",children:s.jsx(Nt,{state:e,visibleMonths:2})})]})}function Nn({state:e}){const{selectedValue:t,setSelectedValue:a}=e;return s.jsxs(kt,{className:"mb-20 mt-10",children:[s.jsx(ls,{state:e,value:t.start,onChange:n=>{a({...t,start:n})}}),s.jsx(un,{className:"block flex-shrink-0 text-muted",size:"md"}),s.jsx(ls,{state:e,value:t.end,onChange:n=>{a({...t,end:n})}})]})}const xe=(e,t)=>{const a=e.split("/");return t&&a.push(t),a};function gi(e,t,a){return re(xe(e,t),()=>In(e,t),{...a,keepPreviousData:!0})}function In(e,t){return z.get(e,{params:t}).then(a=>a.data)}const Cn=(e,t="normalized-models")=>`${t}/${e}`;function Ct(e,t,a,n){const r=Cn(e,n);return re([r,t],()=>Dn(r,t),{keepPreviousData:!0,...a})}async function Dn(e,t){return z.get(e,{params:t}).then(a=>a.data)}const Sn=(e,t,a="normalized-models")=>`${a}/${e}/${t}`;function Dt(e,t,a,n){const r=Sn(e,t,n);return re([r,a],()=>Pn(r,a),{enabled:e!=null&&t!=null})}async function Pn(e,t){return z.get(e,{params:t}).then(a=>a.data)}function An({modelType:e,label:t,className:a,value:n,defaultValue:r="",onChange:i,description:o,errorMessage:l,invalid:c,openMenuOnFocus:f,autoFocus:m,queryParams:p,customEndpoint:h,disabled:x}){var U;const g=u.useRef(null),[b,v]=u.useState(""),[k,N]=qe(n,r,i),S=Ct(e,{query:b,...p},null,h),{trans:C}=O(),R=cs({size:"md"});return k?s.jsxs("div",{className:a,children:[s.jsx("div",{className:R.label,children:t}),s.jsx("div",{className:P("p-10 border rounded",c&&"border-danger"),children:s.jsx(Ke,{initial:!1,mode:"wait",children:s.jsx(Tn,{disabled:x,endpoint:h,modelType:e,modelId:k,queryParams:p,onEditClick:()=>{N(""),v(""),requestAnimationFrame(()=>{var j;(j=g.current)==null||j.focus()})}})})}),o&&!l&&s.jsx("div",{className:R.description,children:o}),l&&s.jsx("div",{className:R.error,children:l})]}):s.jsx(oa,{className:a,showSearchField:!0,invalid:c,errorMessage:l,description:o,isAsync:!0,placeholder:C(I("Select item...")),searchPlaceholder:C(I("Find an item...")),label:t,isLoading:S.isFetching,items:(U=S.data)==null?void 0:U.results,inputValue:b,onInputValueChange:v,selectionMode:"single",selectedValue:k,onSelectionChange:N,ref:g,autoFocus:m,disabled:x,children:j=>s.jsx(xs,{value:j.id,description:j.description,startIcon:s.jsx(vs,{src:j.image}),children:j.name},j.id)})}function Tn({modelType:e,modelId:t,onEditClick:a,endpoint:n,disabled:r,queryParams:i}){const{data:o,isLoading:l}=Dt(e,t,i,n);return l||!(o!=null&&o.model)?s.jsx($n,{},"skeleton"):s.jsxs(ee.div,{className:P("flex items-center gap-10",r&&"text-disabled cursor-not-allowed pointer-events-none"),...fs,children:[o.model.image&&s.jsx(vs,{src:o.model.image}),s.jsxs("div",{children:[s.jsx("div",{children:o.model.name}),s.jsx("div",{className:"text-muted text-xs",children:o.model.description})]}),s.jsx(be,{label:s.jsx(d,{message:"Change item"}),children:s.jsx(B,{className:"ml-auto text-muted",size:"sm",onClick:a,disabled:r,children:s.jsx(Is,{})})})]},"preview")}function $n(){return s.jsxs(ee.div,{className:"flex items-center gap-10",...fs,children:[s.jsx(he,{variant:"rect",size:"w-32 h-32"}),s.jsxs("div",{className:"flex-auto max-h-[36px]",children:[s.jsx(he,{className:"text-xs"}),s.jsx(he,{className:"text-xs max-h-8"})]}),s.jsx(he,{variant:"icon",size:"w-24 h-24"})]})}function Fn({name:e,...t}){const{field:{onChange:a,value:n=""},fieldState:{invalid:r,error:i}}=ms({name:e});return s.jsx(An,{value:n,onChange:a,invalid:r,errorMessage:i==null?void 0:i.message,...t})}function os(e){return{id:e,name:`${e}`,description:`${e}`}}function Vn(e,t){const a=u.useRef(null),n=Qs(t),{displayWith:r=W=>W.name,validateWith:i,children:o,suggestions:l,isLoading:c,inputValue:f,onInputValueChange:m,onItemSelected:p,placeholder:h,onOpenChange:x,chipSize:g="md",openMenuOnFocus:b=!0,showEmptyMessage:v,value:k,defaultValue:N,onChange:S,valueKey:C,isAsync:R,allowCustomValue:U=!0,showDropdownArrow:j,onChipClick:D,...F}=e,E=cs({...e,flexibleHeight:!0}),[q,G]=Ln(e),[le,Y]=u.useState(!1),w=s.jsx(hs,{isIndeterminate:!0,size:"sm","aria-label":"loading..."}),y=j?s.jsx(xa,{}):null,{fieldProps:A,inputProps:V}=Zs({...F,focusRef:n,endAdornment:c&&le?w:y});return s.jsx(Ys,{fieldClassNames:E,...A,children:s.jsxs(yt,{ref:a,className:P("flex items-center flex-wrap",E.input),onClick:()=>{var W;(W=n.current)==null||W.focus()},children:[s.jsx(Mn,{displayChipUsing:r,onChipClick:D,items:q,setItems:G,chipSize:g}),s.jsx(Rn,{showEmptyMessage:v,inputProps:V,inputValue:f,onInputValueChange:m,fieldRef:a,inputRef:n,chips:q,setChips:G,validateWith:i,isLoading:c,suggestions:l,placeholder:h,openMenuOnFocus:b,listboxIsOpen:le,setListboxIsOpen:Y,allowCustomValue:U,children:o})]})})}function Mn({items:e,setItems:t,displayChipUsing:a,chipSize:n,onChipClick:r}){const i=We(),o=u.useCallback(l=>{const c=e.findIndex(m=>m.id===l),f=[...e];return c>-1&&(f.splice(c,1),t(f)),f},[e,t]);return s.jsx(ut,{className:"flex-shrink-0 flex-wrap max-w-full my-8",size:n,selectable:!0,children:e.map(l=>s.jsx(st,{errorMessage:l.errorMessage,adornment:l.image?s.jsx(vs,{circle:!0,src:l.image}):null,onClick:()=>r==null?void 0:r(l),onRemove:()=>{o(l.id).length?i.focusPrevious({tabbable:!0}):i.focusLast()},children:a(l)},l.id))})}function Rn(e){const{inputRef:t,fieldRef:a,validateWith:n,setChips:r,chips:i,suggestions:o,inputProps:l,placeholder:c,openMenuOnFocus:f,listboxIsOpen:m,setListboxIsOpen:p,allowCustomValue:h}=e,x="outline-none text-sm mx-8 my-4 h-30 flex-auto",g=We(),b=u.useCallback(w=>{w=(w||[]).filter(y=>{const A=!y||!y.id||!y.name;return!(i.findIndex(W=>W.id===(y==null?void 0:y.id))>-1)&&!A}),w.length&&(n&&(w=w.map(y=>n(y))),r([...i,...w]))},[i,r,n]),v=ca({...e,clearInputOnItemSelection:!0,isOpen:m,onOpenChange:p,items:o,selectionMode:"none",role:"listbox",virtualFocus:!0,onItemSelected:w=>{q(w)}}),{state:{activeIndex:k,setActiveIndex:N,isOpen:S,setIsOpen:C,inputValue:R,setInputValue:U},refs:j,listboxId:D,collection:F,onInputChange:E}=v,q=w=>{const y=F.size&&k!=null?[...F.values()][k]:null;y!=null&&y.item?b([y.item]):h&&b([os(y?y.value:w)]),U(""),N(null),C(!1)};da(()=>{a.current&&j.reference.current!==a.current&&v.reference(a.current)},[a,v,j]);const{handleTriggerKeyDown:G,handleListboxKeyboardNavigation:le}=fa(v),Y=ha(()=>{f&&!S&&C(!0)});return s.jsx(ua,{listbox:v,mobileOverlay:ma,onPointerDown:w=>{w.preventDefault()},children:s.jsx("input",{type:"text",className:P(x,"bg-transparent"),placeholder:c,...ke(l,{ref:t,value:R,onChange:E,onPaste:w=>{const A=w.clipboardData.getData("text").match(/([a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9._-]+)/gi);if(A){w.preventDefault();const V=window.getSelection();V!=null&&V.rangeCount&&(V.deleteFromDocument(),b(A.map(W=>os(W))))}},"aria-autocomplete":"list","aria-controls":S?D:void 0,autoComplete:"off",autoCorrect:"off",spellCheck:"false",onKeyDown:w=>{const y=w.target;if(w.key==="Enter"){w.preventDefault(),q(y.value);return}if(w.key==="Escape"&&S&&(C(!1),U("")),w.key==="ArrowUp"&&S&&(k===0||k==null)){N(null);return}if(k!=null&&(w.key==="ArrowLeft"||w.key==="ArrowRight")){w.preventDefault();return}if((w.key==="ArrowLeft"||w.key==="Backspace"||w.key==="Delete")&&y.selectionStart===0&&k==null&&i.length){g.focusPrevious({tabbable:!0});return}G(w)||le(w)},onFocus:Y,onClick:Y})})})}function Ln({onChange:e,value:t,defaultValue:a,valueKey:n}){const r=u.useMemo(()=>Os(t),[t]),i=u.useMemo(()=>Os(a),[a]),o=u.useCallback(l=>{const c=n?l.map(f=>f[n]):l;e==null||e(c)},[e,n]);return qe(r||void 0,i||[],o)}function Os(e){if(e!=null)return e.map(t=>typeof t!="object"?os(t):t)}const zn=Be.forwardRef(Vn);function St({children:e,...t}){const{field:{onChange:a,onBlur:n,value:r=[],ref:i},fieldState:{invalid:o,error:l}}=ms({name:t.name}),c={onChange:a,onBlur:n,value:r,invalid:o,errorMessage:l==null?void 0:l.message};return s.jsx(zn,{ref:i,...ke(c,t),children:e})}function Un(e){const t=Se(),[a,n]=u.useState(!e.value&&!e.defaultValue),r=e.onChange,[i,o]=qe(e.value||t,e.defaultValue||t,r),{min:l,max:c,granularity:f,timezone:m,calendarIsOpen:p,setCalendarIsOpen:h,closeDialogOnSelection:x}=wt(i,e),g=u.useCallback(()=>{n(!0),o(t),r==null||r(null),h(!1)},[t,o,r,h]),[b,v]=u.useState(()=>[je(i)]),k=u.useCallback(C=>{l&&C.compare(l)<0?C=l:c&&C.compare(c)>0&&(C=c);const R=i?i.set(C):K(C,m);o(R),v([je(R)]),n(!1)},[o,l,c,i,m]),N=u.useCallback(C=>!a&&fe(i,C),[i,a]),S=u.useCallback(C=>({onClick:()=>{k==null||k(C),x&&(h==null||h(!1))}}),[k,h,x]);return{selectedValue:i,setSelectedValue:o,calendarIsOpen:p,setCalendarIsOpen:h,dayIsActive:N,dayIsHighlighted:()=>!1,dayIsRangeStart:()=>!1,dayIsRangeEnd:()=>!1,getCellProps:S,calendarDates:b,setCalendarDates:v,isPlaceholder:a,clear:g,setIsPlaceholder:n,min:l,max:c,granularity:f,timezone:m,closeDialogOnSelection:x}}function En({showCalendarFooter:e,...t}){const a=Un(t),n=u.useRef(null),r=Se(),i=e&&s.jsx(Ge,{padding:"px-14 pb-14",startAction:s.jsx($,{disabled:a.isPlaceholder,variant:"text",color:"primary",onClick:()=>{a.clear()},children:s.jsx(d,{message:"Clear"})}),children:s.jsx($,{variant:"text",color:"primary",onClick:()=>{a.setSelectedValue(r),a.setCalendarIsOpen(!1)},children:s.jsx(d,{message:"Today"})})}),o=s.jsx(se,{offset:8,placement:"bottom-start",isOpen:a.calendarIsOpen,onOpenChange:a.setCalendarIsOpen,type:"popover",triggerRef:n,returnFocusToTrigger:!1,moveFocusToDialog:!1,children:s.jsxs(we,{size:"auto",children:[s.jsx(Ne,{className:"flex items-start gap-40",padding:e?"px-24 pt-20 pb-10":null,children:s.jsx(Nt,{state:a,visibleMonths:1})}),i]})}),l={onClick:c=>{c.stopPropagation(),c.preventDefault(),On(c)?a.setCalendarIsOpen(!1):a.setCalendarIsOpen(!0)}};return s.jsxs(u.Fragment,{children:[s.jsx(kt,{ref:n,wrapperProps:l,endAdornment:s.jsx(vt,{className:P(t.disabled&&"text-disabled")}),...t,children:s.jsx(ls,{segmentProps:l,state:a,value:a.selectedValue,onChange:a.setSelectedValue,isPlaceholder:a.isPlaceholder})}),o]})}function _n(e){const{min:t,max:a}=e,{trans:n}=O(),{format:r}=X(),{field:{onChange:i,onBlur:o,value:l=null,ref:c},fieldState:{invalid:f,error:m}}=ms({name:e.name,rules:{validate:x=>{if(!x)return;const g=Ue(x);if(t&&g.compare(t)<0)return n({message:"Enter a date after :date",values:{date:r(x)}});if(a&&g.compare(a)>0)return n({message:"Enter a date before :date",values:{date:r(x)}})}}}),p=l?Ue(l):null,h={onChange:x=>{i(x&&x.toAbsoluteString())},onBlur:o,value:p,invalid:f,errorMessage:m==null?void 0:m.message,inputRef:c};return s.jsx(En,{...ke(h,e)})}function On(e){return["hour","minute","dayPeriod"].includes(e.currentTarget.ariaLabel||"")}const Hn=Z(s.jsx("path",{d:"M20 9H4v2h16V9zM4 15h16v-2H4v2z"}),"DragHandleOutlined");function Bn(){const[e,t]=u.useState(!1),a=u.useRef(),n=u.useCallback(r=>{var i;if(r){const o=new IntersectionObserver(([l])=>t(l.intersectionRatio<1),{threshold:[1]});a.current=o,o.observe(r)}else a.current&&((i=a.current)==null||i.disconnect())},[]);return{isSticky:e,sentinelRef:n}}function Pe({onSubmit:e,form:t,title:a,children:n,actions:r,backButton:i,isLoading:o=!1,disableSaveWhenNotDirty:l=!1,wrapInContainer:c=!0}){const{isSticky:f,sentinelRef:m}=Bn(),p=l?Object.keys(t.formState.dirtyFields).length:!0;return s.jsxs(Ie,{onSubmit:e,onBeforeSubmit:()=>t.clearErrors(),form:t,children:[s.jsx("div",{ref:m}),s.jsx("div",{className:P("sticky top-0 my-12 md:my-24 z-10 transition-shadow",f&&"bg-paper shadow"),children:s.jsxs("div",{className:P("flex items-center md:items-start gap-24 py-14",c&&"container mx-auto px-24"),children:[i,s.jsx("h1",{className:"text-xl md:text-3xl whitespace-nowrap overflow-hidden overflow-ellipsis md:mr-64",children:a}),s.jsx("div",{className:"mr-auto"}),r,s.jsx($,{variant:"flat",color:"primary",type:"submit",disabled:o||!p,children:s.jsx(d,{message:"Save"})})]})}),s.jsx("div",{className:c?"container mx-auto px-24 pb-24":void 0,children:s.jsx("div",{className:"rounded",children:n})})]})}const Pt=Z(s.jsx("path",{d:"M9 8a1 1 0 0 0-1-1H5.5a1 1 0 1 0 0 2H7v4a1 1 0 0 0 2 0zM4 0h8a4 4 0 0 1 4 4v8a4 4 0 0 1-4 4H4a4 4 0 0 1-4-4V4a4 4 0 0 1 4-4zm4 5.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"}),"InfoDialogTrigger");function qn({title:e,body:t,dialogSize:a="sm",className:n}){return s.jsxs(se,{type:"popover",triggerOnHover:!0,children:[s.jsx(B,{className:P("text-muted opacity-70",n),size:"xs",children:s.jsx(Pt,{viewBox:"0 0 16 16"})}),s.jsxs(we,{size:a,children:[e&&s.jsx(ps,{padding:"px-18 pt-12",size:"md",hideDismissButton:!0,children:e}),s.jsx(Ne,{children:t})]})]})}const At=""+new URL("music-7a11c2fe.svg",import.meta.url).href;function Wn(e){return re(["artists","search-suggestions",e],()=>Gn(e),{keepPreviousData:!0})}async function Gn(e){return z.get("search/suggestions/artist",{params:e}).then(t=>t.data)}function Tt({name:e,className:t}){const{trans:a}=O(),[n,r]=u.useState(""),{data:i,isLoading:o}=Wn({query:n});return s.jsx(St,{className:t,name:e,label:s.jsx(d,{message:"Artists"}),isAsync:!0,inputValue:n,onInputValueChange:r,suggestions:i==null?void 0:i.results,placeholder:a(I("+Add artist")),isLoading:o,allowCustomValue:!1,children:i==null?void 0:i.results.map(l=>s.jsx(xs,{value:l,startIcon:l.image?s.jsx("img",{className:"rounded-full object-cover w-24 h-24",src:l.image,alt:""}):void 0,children:l.name},l.id))})}function ve({name:e,label:t,placeholder:a,model:n,className:r,allowCustomValue:i=!1}){const[o,l]=u.useState(""),{data:c,isLoading:f}=Ct(n,{query:o});return s.jsx(St,{className:r,name:e,label:t,isAsync:!0,inputValue:o,onInputValueChange:l,suggestions:c==null?void 0:c.results,placeholder:a,isLoading:f,allowCustomValue:i,children:c==null?void 0:c.results.map(m=>s.jsx(xs,{value:m,startIcon:m.image?s.jsx("img",{className:"rounded-full object-cover w-24 h-24",src:m.image,alt:""}):void 0,children:m.name},m.id))})}const $t="tag",Ft=Z(s.jsx("path",{d:"M18 15v3H6v-3H4v3c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-3h-2zM7 9l1.41 1.41L11 7.83V16h2V7.83l2.59 2.58L17 9l-5-5-5 5z"}),"FileUploadOutlined");function Vt({fileUpload:e,status:t,className:a}){const n=(e==null?void 0:e.bytesUploaded)||0,r=u.useMemo(()=>Ms(e.file.size),[e.file.size]),i=u.useMemo(()=>Ms(n),[n]);let o;return t==="completed"?o=s.jsx(d,{message:"Upload complete"}):t==="aborted"?o=s.jsx(d,{message:"Upload cancelled"}):t==="failed"?o=s.jsx(d,{message:"Upload failed"}):t==="processing"?o=s.jsx(d,{message:"Processing upload..."}):t==="pending"?o=s.jsx(d,{message:"Waiting to start..."}):o=s.jsx(d,{message:":bytesUploaded of :totalBytes uploaded",values:{bytesUploaded:i,totalBytes:r}}),s.jsx("div",{className:P("text-muted text-xs",a),children:o})}function Mt({fileUpload:e,status:t,onAbort:a,size:n="md",className:r}){return s.jsxs("div",{className:r,children:[s.jsxs("div",{className:"flex items-center gap-24 justify-between",children:[s.jsx(Vt,{fileUpload:e,status:t}),s.jsx(Kn,{fileUpload:e,status:t,onAbort:a})]}),s.jsx(pa,{size:n==="sm"?"xs":"sm",radius:"rounded-sm",value:e.percentage,isIndeterminate:t==="processing"||t==="pending"})]})}function Kn({fileUpload:e,status:t,onAbort:a}){M(i=>i.abortUpload),M(i=>i.clearInactive);const n=e.errorMessage;let r;if(t==="failed"){const i=n||I("This file could not be uploaded");r=s.jsx(Fe,{children:s.jsx(be,{variant:"danger",label:s.jsx(ga,{value:i}),children:s.jsx(ja,{className:"text-danger",size:"sm"})})})}else t==="aborted"?r=s.jsx(Fe,{children:s.jsx(ba,{className:"text-warning",size:"sm"})}):t==="completed"||t==="processing"?r=s.jsx(Fe,{children:s.jsx(va,{size:"sm",className:"text-primary"})}):a?r=s.jsx(Fe,{children:s.jsx(B,{size:"xs",onClick:()=>a(e.file.id),children:s.jsx(gs,{})})}):r=s.jsx("div",{className:"w-30 h-30"});return s.jsx(Ke,{children:r})}function Fe({children:e,...t}){return s.jsx(ee.div,{className:"flex w-30 h-30 items-center justify-center",...t,initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},children:e})}function Qn(){return ce(e=>Zn(e),{onError:e=>ya(e)})}function Zn(e){return z.post(`tracks/${e.fileEntryId}/extract-metadata`,e).then(t=>Yn(t.data))}function Yn(e){const t={name:e.metadata.title,duration:e.metadata.duration,genres:e.metadata.genres||[],description:e.metadata.comment,lyric:e.metadata.lyrics,release_date:e.metadata.release_date,album_name:e.metadata.album_name};return e.metadata.album&&(t.album_id=e.metadata.album.id),e.metadata.artist&&(t.artists=[e.metadata.artist]),e.metadata.image&&(t.image=e.metadata.image.url),t}function Rt(e,t){var a,n;!((a=e.getValues("artists"))!=null&&a.length)&&t.artists&&e.setValue("artists",t.artists),!e.getValues("image")&&t.image&&e.setValue("image",t.image),t.release_date&&e.setValue("release_date",t.release_date),(n=t.genres)!=null&&n.length&&e.setValue("genres",Me(e.getValues("genres"),t.genres)),!e.getValues("name")&&t.album_name&&e.setValue("name",t.album_name)}function ye(e,t){return{...t,...e,artists:Me(t.artists,e.artists),genres:Me(t.genres,e.genres,"name"),tags:Me(t.tags,e.tags,"name")}}function Me(e=[],t=[],a="id"){return t=t.filter(n=>!e.find(r=>r[a]===n[a])),[...e,...t]}const Jn=50*1024*1024;function es(e){const{uploads:t}=oe(),a=u.useMemo(()=>({allowedFileTypes:[Rs.audio,Rs.video],maxFileSize:t.max_size||Jn}),[t.max_size]),n=Qn(),r=u.useRef(e);r.current=e;const i=M(x=>x.uploadMultiple),o=M(x=>x.updateFileUpload),l=M(x=>x.getUpload),c=u.useCallback((x,g)=>{var b;o(x,{meta:{...((b=l(x))==null?void 0:b.meta)||{},...g}})},[o,l]),f=u.useMemo(()=>({metadata:{diskPrefix:"track_media",disk:ka.public},restrictions:a,onSuccess:(x,g)=>{c(g.id,{isExtractingMetadata:!0}),n.mutate({fileEntryId:x.id,autoMatchAlbum:r.current.autoMatchAlbum},{onSuccess:b=>{c(g.id,{isExtractingMetadata:!1});const v={...b,src:x.url};r.current.onMetadataChange(g,v)},onError:()=>{c(g.id,{isExtractingMetadata:!1})}})},onError:x=>{x&&te.danger(x)}}),[n,c,a]),m=u.useCallback(x=>{const g=x.filter(b=>!wa(b,a));return x.length!==g.length&&te.danger(I(":count of your files is not supported.",{values:{count:x.length-g.length}})),g},[a]),p=u.useCallback(async x=>{if(m(x).length){x.forEach(b=>{var v,k;(k=(v=r.current).onUploadStart)==null||k.call(v,{name:b.name,uploadId:b.id})}),i(x,f);for(const b of x){c(b.id,{isGeneratingWave:!0});const v=await Ea(b.native);v&&r.current.onMetadataChange(b,{waveData:v}),c(b.id,{isGeneratingWave:!1})}}},[f,i,c,m]);return{openFilePicker:u.useCallback(async()=>{const x=await Na({multiple:!0,types:a.allowedFileTypes});await p(x)},[p,a]),uploadTracks:p,validateUploads:m}}function Cs(e){const t=M(r=>e?r.fileUploads.get(e):null);let a=!1,n;if(t){const r=t.meta,i=(r==null?void 0:r.isExtractingMetadata)||(r==null?void 0:r.isGeneratingWave);a=(t==null?void 0:t.status)==="pending"||(t==null?void 0:t.status)==="inProgress"||!!i,n=(t==null?void 0:t.status)==="completed"&&i?"processing":t==null?void 0:t.status}return{isUploading:a,status:n,activeUpload:t}}function Xn(){const[e,t]=u.useState(),{setValue:a,watch:n,getValues:r}=Qe(),{openFilePicker:i}=es({onUploadStart:({uploadId:p})=>t(p),onMetadataChange:(p,h)=>{const x=ye(h,r());Object.entries(x).forEach(([g,b])=>a(g,b,{shouldDirty:!0}))}}),{status:o,isUploading:l,activeUpload:c}=Cs(e),{abortUpload:f,clearInactive:m}=M();return s.jsxs("div",{children:[s.jsx($,{className:"w-full",variant:"flat",color:"primary",startIcon:s.jsx(Ft,{}),disabled:l,onClick:()=>i(),children:n("src")?s.jsx(d,{message:"Replace file"}):s.jsx(d,{message:"Upload file"})}),c&&s.jsx(Mt,{fileUpload:c,status:o,className:"mt-24",onAbort:p=>{f(p),m()}})]})}function Ae({showExternalIdFields:e,showAlbumField:t=!0,uploadButton:a}){const{trans:n}=O(),r=ae();return s.jsxs("div",{className:"md:flex gap-24",children:[s.jsxs("div",{className:"flex-shrink-0",children:[s.jsx(Ze,{name:"image",diskPrefix:"track_image",variant:r?"input":"square",label:r?s.jsx(d,{message:"Image"}):null,previewSize:r?void 0:"w-full md:w-224 aspect-square",stretchPreview:!0}),s.jsx("div",{className:"mt-24",children:a||s.jsx(Xn,{})})]}),s.jsxs("div",{className:"flex-auto mt-24 md:mt-0",children:[s.jsx(L,{name:"name",label:s.jsx(d,{message:"Name"}),className:"mb-24",required:!0,autoFocus:!0}),t&&s.jsx(Fn,{className:"mb-24",label:s.jsx(d,{message:"Album"}),name:"album_id",modelType:mt,openMenuOnFocus:!0,customEndpoint:"search/suggestions"}),s.jsx(Tt,{name:"artists",className:"mb-24"}),s.jsx(ve,{label:s.jsx(d,{message:"Genres"}),placeholder:n(I("+Add genre")),model:ys,name:"genres",allowCustomValue:!0,className:"mb-24"}),s.jsx(ve,{label:s.jsx(d,{message:"Tags"}),placeholder:n(I("+Add tag")),model:$t,name:"tags",allowCustomValue:!0,className:"mb-24"}),s.jsx(L,{name:"description",label:s.jsx(d,{message:"Description"}),inputElementType:"textarea",rows:5,className:"mb-24"}),s.jsx(tr,{}),e&&s.jsx(er,{}),e&&s.jsx(sr,{})]})]})}function er(){return s.jsx(L,{name:"src",label:s.jsx(d,{message:"Playback source"}),className:"mb-24",minLength:1,maxLength:230,description:s.jsx(d,{message:"Supports audio, video, hls/dash stream and youtube video url. If left empty, best matching youtube video will be found automatically."})})}function sr(){const{spotify_is_setup:e}=oe();return e?s.jsx(L,{name:"spotify_id",label:s.jsx(d,{message:"Spotify ID"}),className:"mb-24",minLength:22,maxLength:22}):null}function tr(){const{watch:e}=Qe();return s.jsx(L,{required:!0,name:"duration",label:s.jsx(d,{message:"Duration (in milliseconds)"}),className:"mb-24",type:"number",min:1,max:864e5,description:s.jsx(d,{message:"Will appear on the site as: :preview",values:{preview:s.jsx(_a,{ms:e("duration")})}})})}const Lt="tracks";function zt(e,{onSuccess:t}={}){const{trans:a}=O();return ce(n=>ar(n),{onSuccess:n=>{te(a(I("Track created"))),de.invalidateQueries(xe(Lt)),t==null||t(n)},onError:n=>Ce(n,e)})}function ar(e){return z.post(Lt,Ds(e)).then(t=>t.data)}function Ds(e){var t;return{...e,album_id:e.album_id?e.album_id:null,artists:(t=e.artists)==null?void 0:t.map(a=>a.id)}}function Ut({onTrackCreated:e,defaultValues:t}={}){const a=ie({defaultValues:t}),n=zt(a,{onSuccess:e});return{form:a,createTrack:n}}function ji({wrapInContainer:e}){const t=De(),{pathname:a}=ue(),{form:n,createTrack:r}=Ut({onTrackCreated:i=>{a.includes("admin")?t(`/admin/tracks/${i.track.id}/edit`):t(Ee(i.track))}});return s.jsx(Pe,{form:n,onSubmit:i=>{r.mutate(i)},title:s.jsx(d,{message:"Add new track"}),isLoading:r.isLoading,disableSaveWhenNotDirty:!0,wrapInContainer:e,children:s.jsx(me,{children:s.jsx(Ae,{showExternalIdFields:!0})})})}const nr=e=>`tracks/${e}`;function rr(e,t={}){const{trans:a}=O();return ce(n=>ir(n),{onSuccess:n=>{var r;te(a(I("Track updated"))),de.invalidateQueries(xe("tracks")),(r=t.onSuccess)==null||r.call(t,n)},onError:n=>Ce(n,e)})}function ir({id:e,...t}){return z.put(nr(e),Ds(t)).then(a=>a.data)}function Et(e,t={}){var r;const a=ie({defaultValues:{...e,image:e.image||((r=e.album)==null?void 0:r.image)}}),n=rr(a,{onSuccess:t.onTrackUpdated});return{form:a,updateTrack:n}}function bi({wrapInContainer:e}){const t=xt({forEditing:!0});return t.data?s.jsx(lr,{track:t.data.track,wrapInContainer:e}):s.jsx(js,{query:t,loaderClassName:"absolute inset-0 m-auto"})}function lr({track:e,wrapInContainer:t}){const{canEdit:a}=Oa([e]),n=De(),{pathname:r}=ue(),{form:i,updateTrack:o}=Et(e,{onTrackUpdated:l=>{r.includes("admin")?n("/admin/tracks"):n(Ee(l.track))}});return a?s.jsx(Pe,{form:i,onSubmit:l=>{o.mutate(l)},title:s.jsx(d,{message:"Edit “:name“ track",values:{name:e.name}}),isLoading:o.isLoading,disableSaveWhenNotDirty:!0,wrapInContainer:t,children:s.jsx(me,{children:s.jsx(Ae,{showExternalIdFields:!0})})}):s.jsx(bs,{to:"/",replace:!0})}const _t="albums";function Ot(e){const{trans:t}=O();return ce(a=>or(a),{onSuccess:()=>{te(t(I("Album created"))),de.invalidateQueries(xe(_t))},onError:a=>Ce(a,e)})}function or(e){return z.post(_t,Ht(e)).then(t=>t.data)}function Ht(e){var t,a;return{...e,artists:(t=e.artists)==null?void 0:t.map(n=>n.id),tracks:(a=e.tracks)==null?void 0:a.map(n=>Ds(n))}}const cr=e=>`albums/${e}`;function dr(e,t){const{trans:a}=O(),n=De(),{pathname:r}=ue();return ce(i=>ur(t,i),{onSuccess:i=>{te(a(I("Album updated"))),de.invalidateQueries(xe("albums")),r.includes("admin")?n("/admin/albums"):n(_e(i.album))},onError:i=>Ce(i,e)})}function ur(e,t){return z.put(cr(e),Ht(t)).then(a=>a.data)}function mr({track:e,hideAlbumField:t}){const{formId:a,close:n}=us(),{form:r}=Et(e);return s.jsxs(we,{size:"fullscreen",children:[s.jsx(ps,{children:s.jsx(d,{message:"Edit “:name“ track",values:{name:e.name}})}),s.jsx(Ne,{children:s.jsx(Ie,{id:a,form:r,onSubmit:i=>{n(i)},onBeforeSubmit:()=>{r.clearErrors()},children:s.jsx(Ae,{showExternalIdFields:!0,showAlbumField:!t})})}),s.jsxs(Ge,{children:[s.jsx($,{variant:"text",onClick:()=>n(),children:s.jsx(d,{message:"Cancel"})}),s.jsx($,{form:a,variant:"flat",color:"primary",type:"submit",children:s.jsx(d,{message:"Update"})})]})]})}function xr({defaultValues:e,hideAlbumField:t}){const{formId:a,close:n}=us(),{form:r}=Ut({defaultValues:e});return s.jsxs(we,{size:"fullscreen",children:[s.jsx(ps,{children:s.jsx(d,{message:"Add new track"})}),s.jsx(Ne,{children:s.jsx(Ie,{id:a,form:r,onSubmit:i=>{n(i)},onBeforeSubmit:()=>{r.clearErrors()},children:s.jsx(Ae,{showExternalIdFields:!0,showAlbumField:!t})})}),s.jsxs(Ge,{children:[s.jsx($,{variant:"text",onClick:()=>n(),children:s.jsx(d,{message:"Cancel"})}),s.jsx($,{form:a,variant:"flat",color:"primary",type:"submit",children:s.jsx(d,{message:"Create"})})]})]})}function fr(){const e=Qe(),{watch:t,setValue:a,getValues:n}=e,{fields:r,remove:i,prepend:o,move:l}=tt({name:"tracks"}),c=(p,h)=>{var g;const x=(g=n("tracks"))==null?void 0:g.findIndex(b=>b.uploadId===p);x!=null&&a(`tracks.${x}`,ye(h,n(`tracks.${x}`)),{shouldDirty:!0})},{openFilePicker:f}=es({onUploadStart:p=>o(ye(p,{artists:e.getValues("artists"),genres:e.getValues("genres"),tags:e.getValues("tags")})),onMetadataChange:(p,h)=>{Rt(e,h),c(p.id,h)}}),m=t("tracks")||[];return s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-12",children:[s.jsx("h2",{className:"text-xl font-semibold my-24",children:s.jsx(d,{message:"Tracks"})}),s.jsx($,{variant:"outline",color:"primary",size:"xs",className:"ml-auto",startIcon:s.jsx(Ft,{}),onClick:()=>f(),children:s.jsx(d,{message:"Upload tracks"})}),s.jsxs(se,{type:"modal",onClose:p=>{p&&o(p)},children:[s.jsx(be,{label:s.jsx(d,{message:"Create track"}),children:s.jsx(B,{variant:"outline",color:"primary",size:"xs",radius:"rounded",children:s.jsx(ks,{})})}),s.jsx(xr,{hideAlbumField:!0,defaultValues:{artists:t("artists"),tags:t("tags"),genres:t("genres")}})]})]}),r.map((p,h)=>{const x=m[h];return s.jsx(hr,{track:x,onRemove:()=>i(h),onSort:(g,b)=>l(g,b),tracks:m,onUpdate:g=>{c(x.uploadId,g)}},p.id)}),r.length?null:s.jsx(at,{className:"mt-40",image:s.jsx(nt,{src:At}),title:s.jsx(d,{message:"This album does not have any tracks yet"})})]})}function hr({track:e,tracks:t,onRemove:a,onUpdate:n,onSort:r}){const i=u.useRef(null),o=u.useRef(null),l=M(h=>h.abortUpload),c=M(h=>e.uploadId?h.fileUploads.get(e.uploadId):null),{isUploading:f,status:m}=Cs(e.uploadId),{sortableProps:p}=Ba({disabled:f,ref:i,item:e,items:t,type:"albumFormTrack",preview:o,previewVariant:"line",onSortEnd:(h,x)=>{r(h,x)}});return s.jsxs("div",{className:"border-b border-t border-t-transparent py-4",ref:i,...p,children:[s.jsxs("div",{className:"flex items-center text-sm",children:[s.jsx(B,{className:"flex-shrink-0 mr-14",disabled:f,children:s.jsx(Hn,{})}),s.jsx("div",{className:"flex-auto whitespace-nowrap overflow-hidden overflow-ellipsis",children:e.name}),c&&s.jsxs("div",{className:"flex items-center mr-10",children:[s.jsx(Vt,{fileUpload:c,status:m,className:"mr-10"}),s.jsx(hs,{isIndeterminate:m==="processing",value:c.percentage,size:"sm"})]}),s.jsxs(se,{type:"modal",onClose:h=>{h&&n(h)},children:[s.jsx(be,{label:s.jsx(d,{message:"Edit track"}),children:s.jsx(B,{className:"flex-shrink-0 ml-auto text-muted",disabled:f,children:s.jsx(Is,{})})}),s.jsx(mr,{track:e,hideAlbumField:!0})]}),s.jsxs(se,{type:"modal",onClose:h=>{h&&(e.uploadId&&l(e.uploadId),a())},children:[s.jsx(be,{label:s.jsx(d,{message:"Remove track"}),children:s.jsx(B,{className:"flex-shrink-0 text-muted",children:s.jsx(gs,{})})}),s.jsx(rt,{isDanger:!0,title:s.jsx(d,{message:"Remove track"}),body:s.jsx(d,{message:"Are you sure you want to remove this track from the album?"}),confirm:s.jsx(d,{message:"Remove"})})]})]}),s.jsx(pr,{track:e,ref:o})]})}const pr=Be.forwardRef(({track:e},t)=>{var n,r;let a=e.name;return(n=e.artists)!=null&&n.length&&(a+=`- ${(r=e.artists)==null?void 0:r[0].name}`),s.jsx(Ha,{ref:t,children:()=>s.jsx("div",{className:"p-8 rounded shadow bg-chip text-sm",children:a})})});function Ss({showExternalIdFields:e}){const{trans:t}=O(),a=ae();return s.jsxs(u.Fragment,{children:[s.jsxs("div",{className:"md:flex gap-24",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx(Ze,{name:"image",diskPrefix:"album_images",label:a?s.jsx(d,{message:"Image"}):null,variant:a?"input":"square",previewSize:a?void 0:"w-full md:w-224 aspect-square",stretchPreview:!0})}),s.jsxs("div",{className:"flex-auto mt-24 md:mt-0",children:[s.jsx(L,{name:"name",label:s.jsx(d,{message:"Name"}),className:"mb-24",required:!0,autoFocus:!0}),s.jsx(_n,{name:"release_date",label:s.jsx(d,{message:"Release date"}),className:"mb-24",granularity:"day"}),s.jsx(Tt,{name:"artists",className:"mb-24"}),s.jsx(ve,{label:s.jsx(d,{message:"Genres"}),placeholder:t(I("+Add genre")),model:ys,name:"genres",allowCustomValue:!0,className:"mb-24"}),s.jsx(ve,{label:s.jsx(d,{message:"Tags"}),placeholder:t(I("+Add tag")),model:$t,name:"tags",allowCustomValue:!0,className:"mb-24"}),s.jsx(L,{name:"description",label:s.jsx(d,{message:"Description"}),inputElementType:"textarea",rows:5,className:"mb-24"}),e&&s.jsx(gr,{})]})]}),s.jsx(fr,{})]})}function gr(){const{spotify_is_setup:e}=oe();return e?s.jsx(L,{name:"spotify_id",label:s.jsx(d,{message:"Spotify ID"}),className:"mb-24",minLength:22,maxLength:22}):null}function vi({wrapInContainer:e}){const t=ft({forEditing:!0,with:"tags,genres,artists,fullTracks"});return t.data?s.jsx(me,{children:s.jsx(jr,{album:t.data.album,wrapInContainer:e})}):s.jsx(js,{query:t,loaderClassName:"absolute inset-0 m-auto"})}function jr({album:e,wrapInContainer:t}){const{canEdit:a}=qa(e),n=!!M(o=>o.activeUploadsCount),r=ie({defaultValues:{image:e.image,name:e.name,release_date:e.release_date,artists:e.artists,genres:e.genres,tags:e.tags,description:e.description,spotify_id:e.spotify_id,tracks:e.tracks}}),i=dr(r,e.id);return a?s.jsx(Pe,{form:r,onSubmit:o=>{i.mutate(o)},title:s.jsx(d,{message:"Edit “:name“ album",values:{name:e.name}}),isLoading:i.isLoading||n,disableSaveWhenNotDirty:!0,wrapInContainer:t,children:s.jsx(Ss,{showExternalIdFields:!0})}):s.jsx(bs,{to:"/",replace:!0})}const br=u.forwardRef(({onUploadStart:e,onCancel:t,onCreate:a},n)=>{const r=ht(),i=Se(),[o,l]=u.useState(!1),c=ie({defaultValues:{tracks:[],artists:r?[r]:[],release_date:i.toAbsoluteString()}}),f=c.watch("tracks")||[],m=M(v=>v.abortUpload),p=!!M(v=>v.activeUploadsCount),{openFilePicker:h,uploadTracks:x,validateUploads:g}=es({onUploadStart:v=>{l(!0),c.setValue("tracks",[...c.getValues("tracks"),v]),e()},onMetadataChange:(v,k)=>{Rt(c,k),c.setValue("tracks",c.getValues("tracks").map(N=>N.uploadId===v.id?ye(k,N):N))}});u.useImperativeHandle(n,()=>({openFilePicker:h,uploadTracks:x,validateUploads:g}),[h,x,g]);const b=Ot(c);return o?s.jsxs(Ie,{className:"rounded border p-14 md:p-24 mb-30 bg-paper",form:c,onSubmit:v=>b.mutate(v,{onSuccess:k=>{l(!1),c.reset(),a(k.album)}}),children:[s.jsx(Ss,{showExternalIdFields:!1}),s.jsxs("div",{className:"mt-24",children:[s.jsx($,{variant:"text",onClick:()=>{f.forEach(v=>{m(v.uploadId)}),c.reset(),l(!1),t()},className:"mr-10",children:s.jsx(d,{message:"Cancel"})}),s.jsx($,{type:"submit",variant:"flat",color:"primary",disabled:p||b.isLoading,children:s.jsx(d,{message:"Save"})})]})]}):null}),vr=u.forwardRef(({onUploadStart:e,onCancel:t,onCreate:a},n)=>{const r=ht(),i=M(p=>p.abortUpload),[o,l]=u.useState([]),{openFilePicker:c,uploadTracks:f,validateUploads:m}=es({onUploadStart:p=>{l(h=>r?[...h,{...p,artists:[r]}]:[...h,p]),e()},onMetadataChange:(p,h)=>{l(x=>x.map(g=>g.uploadId===p.id?ye(h,g):g))}});return u.useImperativeHandle(n,()=>({openFilePicker:c,uploadTracks:f,validateUploads:m}),[c,f,m]),s.jsx("div",{className:"w-full",children:o.map(p=>s.jsx(yr,{track:p,onCreate:h=>{l(x=>x.filter(g=>g.uploadId!==p.uploadId)),a(h)},onRemove:()=>{l(h=>{const x=h.filter(g=>g.uploadId!==p.uploadId);return x.length||t(),x}),i(p.uploadId)}},p.uploadId))})}),yr=u.memo(({track:e,onRemove:t,onCreate:a})=>{const n=ie({defaultValues:e}),r=zt(n),i=M(f=>f.fileUploads.get(e.uploadId)),{isUploading:o,status:l}=Cs(e.uploadId);u.useEffect(()=>{n.reset(e)},[e,n]);const c=o&&i?s.jsx(Mt,{fileUpload:i,status:l}):null;return s.jsxs(Ie,{form:n,onSubmit:f=>{r.mutate(f,{onSuccess:m=>a(m.track)})},className:"rounded border p-14 md:p-24 mb-30 bg-paper",children:[s.jsx(Ae,{uploadButton:c,showExternalIdFields:!1}),s.jsx($,{variant:"text",onClick:()=>t(),className:"mr-10",children:s.jsx(d,{message:"Cancel"})}),s.jsx($,{type:"submit",variant:"flat",color:"primary",disabled:r.isLoading||!n.watch("src"),children:s.jsx(d,{message:"Save"})})]})}),kr=""+new URL("album-border-b5dd7d9f.png",import.meta.url).href;function wr({media:e}){var n,r;const t=e.model_type===mt,a=t?_e(e,{absolute:!0}):Ee(e,{absolute:!0});return s.jsxs("div",{className:"flex items-center gap-28 border rounded bg-paper p-20 my-20 mx-auto w-780 max-w-full",children:[s.jsxs("div",{className:P(t&&"relative isolate my-14 mx-18"),children:[t?s.jsx(Je,{album:e,className:"rounded flex-shrink-0 z-20 relative",size:"w-132 h-132"}):s.jsx(ws,{track:e,className:"rounded flex-shrink-0 z-20 relative",size:"w-132 h-132"}),t&&s.jsx("img",{className:"absolute block w-160 h-160 max-w-160 -top-14 -left-14 z-10",src:kr,alt:""})]}),s.jsxs("div",{className:"flex-auto",children:[s.jsx("div",{className:"text-base font-bold",children:e.name}),s.jsx("div",{className:"text-muted text-sm mb-14",children:s.jsx(Xe,{artists:e.artists})}),(n=e.genres)!=null&&n.length?s.jsx(ut,{selectable:!1,size:"sm",className:"mb-14",children:(r=e.genres)==null?void 0:r.map(i=>s.jsx(st,{children:i.display_name||i.name},i.id))}):null,s.jsx("div",{className:"text-sm",children:s.jsx(d,{message:"Upload complete. <a>Go to your track</a>",values:{a:i=>s.jsx(J,{className:it,to:t?_e(e):Ee(e),children:i})}})})]}),s.jsx("div",{className:"ml-auto flex-auto max-w-300",children:s.jsxs("div",{className:"text-muted text-sm",children:[s.jsx(d,{message:"Share your new track"}),s.jsx(Wa,{name:e.name,image:e.image,link:a}),s.jsx(Ia,{value:a,readOnly:!0,className:"mt-24 w-full",size:"sm",onClick:i=>{i.target.select()}})]})})]})}function Nr({isVisible:e}){const t=s.jsx(ee.div,{...fs,transition:{duration:.3},className:"absolute inset-0 w-full min-h-full bg-primary-light/30 border-2 border-dashed border-primary pointer-events-none",children:s.jsx(ee.div,{initial:{y:"100%",opacity:0},animate:{y:"-10px",opacity:1},exit:{y:"100%",opacity:0},className:"p-10 bg-primary text-on-primary fixed bottom-0 left-0 right-0 max-w-max mx-auto rounded",children:s.jsx(d,{message:"Drop your files anywhere on the page to upload"})})},"dragTargetMask");return s.jsx(Ke,{children:e?t:null})}function Ir(){const{user:e}=ge();e!=null&&e.id&&de.resetQueries(["minutesLimit",e.id])}function Cr(){const{user:e}=Ca(),t=e==null?void 0:e.id;return re(["minutesLimit",t],()=>Dr(t),{enabled:t!=null})}function Dr(e){return z.get(`users/${e}/minutes-left`).then(t=>t.data)}const Sr=""+new URL("light-bg-8c37cb47.svg",import.meta.url).href,Pr=""+new URL("dark-bg-38ecc414.svg",import.meta.url).href;function Ar({children:e,...t}){const a=Da();return s.jsxs("div",{className:"h-full flex flex-col",...t,children:[s.jsx(lt,{className:"flex-shrink-0",color:"bg",darkModeColor:"bg"}),s.jsx("div",{className:"overflow-y-auto flex-auto bg-cover relative",style:{backgroundImage:`url(${a?Pr:Sr})`},children:s.jsxs("div",{className:"container mx-auto p-14 md:p-24 min-h-full flex flex-col",children:[s.jsx("div",{className:"flex-auto",children:e}),s.jsx(ot,{})]})})]})}function yi({backstageLayout:e=!0}){return s.jsx(me,{children:s.jsx(Tr,{backstageLayout:e})})}function Tr({backstageLayout:e}){const[t,a]=u.useState("tracks"),[n,r]=u.useState(!1),i=u.useRef(null),o=t==="tracks"?vr:br,[l,c]=u.useState([]),f=u.useRef(null),[m,p]=u.useState(!1),{droppableProps:h}=Ga({id:"uploadPageRoot",ref:f,types:["nativeFile"],onDragEnter:()=>p(!0),onDragLeave:()=>p(!1),onDrop:async g=>{var b,v;if(g.type==="nativeFile"){const k=await g.getData(),N=(b=i.current)==null?void 0:b.validateUploads(k);N!=null&&N.length&&((v=i.current)==null||v.uploadTracks(N))}}}),x=e?Ar:Fr;return s.jsxs(x,{...h,children:[!n&&s.jsx($r,{onUpload:()=>{var g;return(g=i.current)==null?void 0:g.openFilePicker()},uploadMode:t,onUploadModeChange:a}),l.map(g=>s.jsx(wr,{media:g},g.id)),s.jsx(o,{ref:i,onUploadStart:()=>r(!0),onCreate:g=>{c(b=>[...b,g]),Ir()},onCancel:()=>{r(!1)}}),s.jsx(Nr,{isVisible:m})]})}function $r({onUpload:e,uploadMode:t,onUploadModeChange:a}){const{data:n}=Cr();return s.jsxs("div",{className:"pt-40",children:[s.jsxs("div",{className:"border rounded p-20 md:p-48 flex flex-col items-center max-w-580 mx-auto bg-paper",children:[s.jsx("h1",{className:"text-base md:text-[22px] md:font-light",children:s.jsx(d,{message:"Drag and drop your tracks, videos & albums here."})}),s.jsx($,{variant:"flat",color:"primary",className:"mt-20 w-min",onClick:()=>e(),children:s.jsx(d,{message:"Or choose files to upload"})}),s.jsx("div",{className:"border-t pt-20 mt-20",children:s.jsx(Ka,{checked:t==="album",onChange:r=>a(r.target.checked?"album":"tracks"),children:s.jsx(d,{message:"Make an album when multiple files are selected"})})})]}),s.jsx("div",{className:"text-muted mt-20 text-sm text-center min-h-20",children:(n==null?void 0:n.minutesLeft)!=null&&s.jsx(d,{message:"You have :count minutes left. Try <a>Pro accounts</a> to get more time and access to advanced features.",values:{count:n.minutesLeft,a:r=>s.jsx(J,{className:it,to:"/pricing",children:r})}})})]})}function Fr({children:e,...t}){return s.jsx("div",{...t,className:"min-h-full relative",children:s.jsx("div",{className:"container mx-auto p-14 md:p-24",children:e})})}function ki({wrapInContainer:e}){return s.jsx(me,{children:s.jsx(Vr,{wrapInContainer:e})})}function Vr({wrapInContainer:e}){const t=!!M(m=>m.activeUploadsCount),a=Se(),n=De(),{pathname:r}=ue(),[i]=Sa(),{data:o}=Dt(Qa,i.get("artistId")),l=o==null?void 0:o.model,c=ie({defaultValues:{release_date:a.toAbsoluteString()}}),f=Ot(c);return u.useEffect(()=>{l&&c.reset({artists:[l]})},[l,c]),s.jsx(Pe,{form:c,onSubmit:m=>{f.mutate(m,{onSuccess:p=>{r.includes("admin")?n(l?`/admin/artists/${l.id}/edit`:"/admin/albums"):n(_e(p.album))}})},title:s.jsx(d,{message:"Add new album"}),isLoading:f.isLoading||t,disableSaveWhenNotDirty:!0,wrapInContainer:e,children:s.jsx(Ss,{showExternalIdFields:!0})})}function wi(){const{requestId:e}=Ye();return re(["backstage-request",+e],()=>Mr(e))}function Mr(e){return z.get(`backstage-request/${e}`).then(t=>t.data)}const Ni=Z(s.jsx("path",{d:"M7 3H4v3H2V1h5v2zm15 3V1h-5v2h3v3h2zM7 21H4v-3H2v5h5v-2zm13-3v3h-3v2h5v-5h-2zM17 6H7v12h10V6zm2 12c0 1.1-.9 2-2 2H7c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2v12zM15 8H9v2h6V8zm0 3H9v2h6v-2zm0 3H9v2h6v-2z"}),"DocumentScannerOutlined"),Rr=[{key:"name",allowsSorting:!0,header:()=>s.jsx(d,{message:"Name"}),visibleInMode:"all",width:"flex-3",body:e=>s.jsxs("div",{className:"flex items-center gap-12",children:[s.jsx(Je,{album:e,className:"flex-shrink-0",size:"w-34 h-34 rounded"}),s.jsx(Ns,{album:e,target:"_blank"})]})},{key:"release_date",allowsSorting:!0,header:()=>s.jsx(d,{message:"Release date"}),body:e=>e.release_date?s.jsx(Pa,{date:e.release_date}):null},{key:"track_count",allowsSorting:!1,header:()=>s.jsx(d,{message:"Track count"}),body:e=>e.tracks_count?s.jsx(Oe,{value:e.tracks_count}):null},{key:"plays",allowsSorting:!0,header:()=>s.jsx(d,{message:"Plays"}),body:e=>e.plays?s.jsx(Oe,{value:e.plays}):null},{key:"actions",header:()=>s.jsx(d,{message:"Actions"}),width:"w-84 flex-shrink-0",visibleInMode:"all",hideHeader:!0,align:"end",body:e=>s.jsx(zr,{album:e})}];function Lr({albums:e=[]}){const{watch:t}=Qe(),a=t("id"),{data:n,sortDescriptor:r,onSortChange:i}=Za(e);return s.jsxs("div",{children:[s.jsxs("div",{className:"my-24",children:[s.jsxs("div",{className:"flex items-center gap-12",children:[s.jsx("h2",{className:"text-xl font-semibold",children:s.jsx(d,{message:"Albums"})}),s.jsx($,{variant:"outline",color:"primary",size:"xs",className:"ml-auto",startIcon:s.jsx(ks,{}),elementType:a?J:void 0,to:`/admin/albums/new?artistId=${a}`,disabled:!a,children:s.jsx(d,{message:"Add album"})})]}),!a&&s.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[s.jsx(Pt,{viewBox:"0 0 16 16",size:"xs",className:"text-muted"}),s.jsx(d,{message:"Save changes to enable album creation."})]})]}),s.jsx(Ya,{columns:Rr,data:e,sortDescriptor:r,onSortChange:i,enableSelection:!1}),n.length?null:s.jsx(at,{className:"mt-40",image:s.jsx(nt,{src:At}),title:s.jsx(d,{message:"This artist does not have any albums yet"})})]})}function zr({album:e}){const t=Ja();return s.jsxs("div",{className:"text-muted",children:[s.jsx(J,{to:`../../../albums/${e.id}/edit`,relative:"path",children:s.jsx(B,{size:"md",children:s.jsx(Is,{})})}),s.jsxs(se,{type:"modal",onClose:a=>{a&&t.mutate({albumId:e.id})},children:[s.jsx(B,{size:"md",disabled:t.isLoading,children:s.jsx(gs,{})}),s.jsx(rt,{isDanger:!0,title:s.jsx(d,{message:"Delete album"}),body:s.jsx(d,{message:"Are you sure you want to delete this album?"}),confirm:s.jsx(d,{message:"Delete"})})]})]})}function Ur({albums:e,showExternalFields:t}){const a=ae();return s.jsxs(me,{children:[s.jsxs("div",{className:"md:flex gap-24",children:[s.jsxs("div",{className:"flex-shrink-0",children:[s.jsx(Ze,{name:"image_small",diskPrefix:"artist_images",label:a?s.jsx(d,{message:"Image"}):null,variant:a?"input":"square",previewSize:a?void 0:"w-full md:w-224 aspect-square",stretchPreview:!0}),t&&s.jsx(Xa,{name:"verified",className:"mt-14",children:s.jsx(d,{message:"Verified"})})]}),s.jsx("div",{className:"flex-auto mt-24 md:mt-0",children:s.jsxs(en,{isLazy:!0,children:[s.jsxs(sn,{children:[s.jsx(Te,{children:s.jsx(d,{message:"Details"})}),s.jsx(Te,{children:s.jsx(d,{message:"Links"})}),s.jsx(Te,{children:s.jsx(d,{message:"Biography"})}),s.jsx(Te,{children:s.jsx(d,{message:"Images"})})]}),s.jsxs(tn,{className:"pt-20",children:[s.jsx($e,{children:s.jsx(Er,{showExternalFields:t})}),s.jsx($e,{children:s.jsx(an,{})}),s.jsx($e,{children:s.jsx(_r,{})}),s.jsx($e,{children:s.jsx(Or,{})})]})]})})]}),s.jsx(Lr,{albums:e})]})}function Er({showExternalFields:e}){const{trans:t}=O();return s.jsxs(u.Fragment,{children:[s.jsx(L,{name:"name",label:s.jsx(d,{message:"Name"}),className:"mb-24",required:!0,autoFocus:!0,disabled:!e}),s.jsx(ve,{label:s.jsx(d,{message:"Genres"}),placeholder:t(I("+Add genre")),model:ys,name:"genres",allowCustomValue:!0,className:"mb-24"}),e&&s.jsx(Hr,{})]})}function _r(){return s.jsxs(u.Fragment,{children:[s.jsx(L,{name:"profile.country",label:s.jsx(d,{message:"Country"}),className:"mb-24"}),s.jsx(L,{name:"profile.city",label:s.jsx(d,{message:"City"}),className:"mb-24"}),s.jsx(L,{inputElementType:"textarea",rows:5,name:"profile.description",label:s.jsx(d,{message:"Description"}),className:"mb-24"})]})}function Or(){const{fields:e,append:t,remove:a}=tt({name:"profile_images"});return s.jsxs("div",{children:[s.jsx("div",{className:"flex gap-12 flex-wrap mb-24",children:e.map((n,r)=>s.jsx(Ze,{name:`profile_images.${r}.url`,diskPrefix:"artist_images",variant:"square",previewSize:"w-160 h-160",stretchPreview:!0,showRemoveButton:!0,onChange:i=>{i||a(r)}},n.id))}),s.jsx($,{variant:"outline",color:"primary",startIcon:s.jsx(ks,{}),onClick:()=>{t({url:""})},children:s.jsx(d,{message:"Add another image"})})]})}function Hr(){const{spotify_is_setup:e}=oe();return e?s.jsx(L,{name:"spotify_id",label:s.jsx(d,{message:"Spotify ID"}),className:"mb-24",minLength:22,maxLength:22}):null}const Br=e=>`artists/${e}`;function qr(e){const{trans:t}=O(),a=De(),{pathname:n}=ue();return ce(r=>Wr(r),{onSuccess:r=>{te(t(I("Artist updated"))),de.invalidateQueries(xe("artists")),n.includes("admin")?a("/admin/artists"):a(Aa(r.artist))},onError:r=>Ce(r,e)})}function Wr({id:e,...t}){return z.put(Br(e),t).then(a=>a.data)}function Ii({wrapInContainer:e,showExternalFields:t}){const a=pt({forEditing:!0,with:"albums,genres,profile",albumsPerPage:50});return a.data?s.jsx(Gr,{response:a.data,wrapInContainer:e,showExternalFields:t}):s.jsx(js,{query:a,loaderClassName:"absolute inset-0 m-auto"})}function Gr({response:e,wrapInContainer:t,showExternalFields:a}){var o;const{canEdit:n}=nn(e.artist),r=ie({defaultValues:{id:e.artist.id,name:e.artist.name,verified:e.artist.verified,spotify_id:e.artist.spotify_id,genres:e.artist.genres,image_small:e.artist.image_small,links:e.artist.links,profile:e.artist.profile,profile_images:e.artist.profile_images}}),i=qr(r);return n?s.jsx(Pe,{form:r,onSubmit:l=>{i.mutate(l)},title:s.jsx(d,{message:"Edit “:name“ artist",values:{name:e.artist.name}}),isLoading:i.isLoading,disableSaveWhenNotDirty:!0,wrapInContainer:t,children:s.jsx(Ur,{albums:(o=e.albums)==null?void 0:o.data,showExternalFields:a})}):s.jsx(bs,{to:"/",replace:!0})}const Kr={month:"short",day:"2-digit"};function Qr({value:e,onChange:t,compactOnMobile:a=!0}){const n=ae();return s.jsxs(se,{type:"popover",onClose:r=>{r&&t(r)},children:[s.jsx($,{variant:"outline",color:"chip",endIcon:s.jsx(vt,{}),children:s.jsx(It,{start:e.start,end:e.end,options:n&&a?Kr:Xs.short})}),s.jsx(Zr,{value:e})]})}function Zr({value:e}){const t=ae(),a=dn({defaultValue:e,closeDialogOnSelection:!1});return s.jsx(kn,{state:a,showInlineDatePickerField:!t})}function Ps(e){const{title:t,description:a,children:n,className:r,contentIsFlex:i=!0,contentClassName:o,contentRef:l,minHeight:c="min-h-440"}=e;return s.jsxs("div",{className:P("bg border rounded h-full flex flex-col flex-auto",c,r),children:[s.jsxs("div",{className:"text-xs p-14 flex-shrink-0 flex justify-between items-center",children:[s.jsx("div",{className:"font-semibold text-sm",children:t}),a&&s.jsx("div",{className:"text-muted",children:a})]}),s.jsx("div",{ref:l,className:P("p-14 relative",i&&"flex-auto flex items-center justify-center",o),children:n})]})}function He(){return s.jsxs("div",{className:"flex items-center gap-10 text-sm absolute mx-auto",children:[s.jsx(hs,{isIndeterminate:!0,size:"sm"}),s.jsx(d,{message:"Chart loading"})]})}const Yr=u.lazy(()=>Ta(()=>import("./lazy-chart-96c33072.js"),["./lazy-chart-96c33072.js","./main-1406e08c.js","./main-f52edbcd.css"],import.meta.url));function Bt(e){const{title:t,description:a,className:n,contentRef:r,isLoading:i}=e;return s.jsx(Ps,{title:t,description:a,className:n,contentRef:r,children:s.jsxs(u.Suspense,{fallback:s.jsx(He,{}),children:[s.jsx(Yr,{...e}),i&&s.jsx(He,{})]})})}function qt(e,{localeCode:t="en",shareFirstDatasetLabels:a=!0}){if(!e)return{datasets:[]};const n=[];return{...e,datasets:e.datasets.map((r,i)=>{const o=r.data.map((l,c)=>{let f;return i===0||!a?(f=Jr(l,e.granularity,t),n[c]=f):f=n[c],{...f,value:l.value}});return{...r,data:o}})}}function Jr(e,t,a){return e.label!=null?{label:e.label}:e.date?Xr(e,t,a):{label:""}}function Xr({date:e,endDate:t,value:a},n="day",r){const i=Ue(e).toDate(),o=t?Ue(t).toDate():null;switch(n){case"minute":return{label:_(r,{second:"2-digit"}).format(i),tooltipTitle:_(r,{day:"2-digit",hour:"numeric",minute:"numeric",second:"2-digit"}).format(i)};case"hour":return{label:_(r,{hour:"numeric",minute:"numeric"}).format(i),tooltipTitle:_(r,{month:"short",day:"2-digit",hour:"numeric",minute:"numeric"}).format(i)};case"day":return{label:_(r,{day:"2-digit",weekday:"short"}).format(i),tooltipTitle:_(r,{day:"2-digit",weekday:"short",month:"short"}).format(i)};case"week":return{label:_(r,{month:"short",day:"2-digit"}).format(i),tooltipTitle:_(r,{day:"2-digit",month:"long",year:"numeric"}).formatRange(i,o)};case"month":return{label:_(r,{month:"short",year:"numeric"}).format(i),tooltipTitle:_(r,{month:"long",year:"numeric"}).format(i)};case"year":return{label:_(r,{year:"numeric"}).format(i),tooltipTitle:_(r,{year:"numeric"}).format(i)}}}const _=$a((e,t)=>new Fa(e,t),{equals:(e,t)=>et(e,t),callTimeout:void 0}),Hs=ge().themes.all[0].colors["--be-primary"],pe=[[`rgb(${Hs.replaceAll(" ",",")})`,`rgba(${Hs.replaceAll(" ",",")},0.2)`],["rgb(255,112,67)","rgb(255,112,67,0.2)"],["rgb(255,167,38)","rgb(255,167,38,0.2)"],["rgb(141,110,99)","rgb(141,110,99,0.2)"],["rgb(102,187,106)","rgba(102,187,106,0.2)"],["rgb(92,107,192)","rgb(92,107,192,0.2)"]],ei={parsing:{xAxisKey:"label",yAxisKey:"value"},datasets:{line:{fill:"origin",tension:.1,pointBorderWidth:4,pointHitRadius:10}},plugins:{tooltip:{intersect:!1,mode:"index"}}};function si({data:e,className:t,...a}){const{localeCode:n}=ne(),r=u.useMemo(()=>{const i=qt(e,{localeCode:n});return i.datasets=i.datasets.map((o,l)=>({...o,backgroundColor:pe[l][1],borderColor:pe[l][0],pointBackgroundColor:pe[l][0]})),i},[e,n]);return s.jsx(Bt,{...a,className:P(t,"min-w-500"),data:r,type:"line",options:ei})}const ti={parsing:{key:"value"},plugins:{tooltip:{intersect:!0}}};function Bs({data:e,className:t,...a}){const{localeCode:n}=ne(),r=u.useMemo(()=>{var o;const i=qt(e,{localeCode:n});return i.labels=(o=i.datasets[0])==null?void 0:o.data.map(l=>l.label),i.datasets=i.datasets.map((l,c)=>({...l,backgroundColor:pe.map(f=>f[1]),borderColor:pe.map(f=>f[0]),borderWidth:2})),i},[e,n]);return s.jsx(Bt,{type:"polarArea",data:r,options:ti,className:P(t,"min-w-500"),...a})}const qs="https://www.gstatic.com/charts/loader.js";function ai({placeholderRef:e,data:t,country:a,onCountrySelected:n}){const{trans:r}=O(),{analytics:i}=oe(),o=i==null?void 0:i.gchart_api_key,{selectedTheme:l}=Va(),c=u.useRef(),f=!!n&&!a,m=u.useCallback(()=>{var v,k;if(typeof google>"u")return;const h=t.map(N=>[N.label,N.value]);h.unshift([r(a?I("City"):I("Country")),r(I("Clicks"))]);const x=`${zs(l.colors["--be-paper"])}`,b={colorAxis:{colors:[`${zs(l.colors["--be-primary"])}`]},backgroundColor:x,region:a?a.toUpperCase():void 0,resolution:a?"provinces":"countries",displayMode:a?"markers":"regions",enableRegionInteractivity:f};!c.current&&e.current&&((v=google==null?void 0:google.visualization)!=null&&v.GeoChart)&&(c.current=new google.visualization.GeoChart(e.current)),(k=c.current)==null||k.draw(google.visualization.arrayToDataTable(h),b)},[l,t,e,r,a,f]),p=u.useCallback(()=>{Ls.alreadyLoading(qs)||Ls.loadAsset(qs,{type:"js"}).then(()=>{google.charts.load("current",{packages:["geochart"],mapsApiKey:o,callback:()=>{m(),c.current&&n&&google.visualization.events.addListener(c.current,"regionClick",h=>{n==null||n(h.region)})}})})},[o,m,n]);return u.useEffect(()=>{p()},[p]),u.useEffect(()=>{m()},[l,m,t]),{drawGoogleChart:m}}const ni=Z(s.jsx("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"}),"ArrowBackOutlined"),ri=u.memo(({code:e})=>{const{localeCode:t}=ne(),a=new Intl.DisplayNames([t],{type:"region"});let n;try{n=a.of(e.toUpperCase())}catch{}return s.jsx(u.Fragment,{children:n})});function ii({data:e,isLoading:t,onCountrySelected:a,country:n,...r}){const i=u.useRef(null),o=!!a,l=e==null?void 0:e.datasets[0].data,c=u.useMemo(()=>l||[],[l]);return ai({placeholderRef:i,data:c,country:n,onCountrySelected:a}),s.jsxs(Ps,{...r,className:"min-w-500",title:s.jsxs("div",{className:"flex items-center",children:[s.jsx(d,{message:"Top Locations"}),n?s.jsxs("span",{className:"pl-4",children:["(",s.jsx(ri,{code:n}),")"]}):null,o&&s.jsx(li,{})]}),contentIsFlex:t,children:[t&&s.jsx(He,{}),s.jsxs("div",{className:"flex gap-24",children:[s.jsx("div",{ref:i,className:"flex-auto w-[480px] min-h-[340px]"}),s.jsxs("div",{className:"w-[170px]",children:[s.jsx("div",{className:"text-sm max-h-[340px] w-full flex-initial overflow-y-auto",children:c.map(f=>s.jsxs("div",{className:P("flex items-center gap-4 mb-4",o&&"cursor-pointer hover:underline"),role:o?"button":void 0,onClick:()=>{a==null||a(f.code)},children:[s.jsx("div",{className:"max-w-110 whitespace-nowrap overflow-hidden overflow-ellipsis",children:f.label}),s.jsxs("div",{children:["(",f.percentage,")%"]})]},f.label))}),n&&s.jsx($,{variant:"outline",size:"xs",className:"mt-14",startIcon:s.jsx(ni,{}),onClick:()=>{a==null||a(void 0)},children:s.jsx(d,{message:"Back to countries"})})]})]})]})}function li(){return s.jsx(qn,{title:s.jsx(d,{message:"Zooming in"}),body:s.jsx(d,{message:"Click on a country inside the map or country list to zoom in and see city data for that country."})})}const Ws="reports/insights";function oi(e,t){return re([Ws,e],()=>ci(Ws,e),{keepPreviousData:!0,enabled:t.isEnabled})}function ci(e,t){var n;const a={model:t.model,metrics:(n=t.metrics)==null?void 0:n.join(",")};return a.startDate=t.dateRange.start.toAbsoluteString(),a.endDate=t.dateRange.end.toAbsoluteString(),a.timezone=t.dateRange.start.timeZone,z.get(e,{params:a}).then(r=>r.data)}const di=Z(s.jsx("path",{d:"M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"}),"InfoOutlined");function Ve({data:e,isLoading:t,...a}){const n=(e==null?void 0:e.datasets[0].data)||[];return s.jsxs(Ps,{...a,className:"min-w-500 md:min-w-0 w-1/2",contentIsFlex:t,contentClassName:"max-h-[370px] overflow-y-auto compact-scrollbar",children:[t&&s.jsx(He,{}),n.map(r=>s.jsxs("div",{className:"mb-20 text-sm flex items-center justify-between gap-24",children:[s.jsxs("div",{className:"flex items-center gap-8",children:[s.jsx(ui,{model:r.model,size:"w-42 h-42",className:"rounded flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm",children:s.jsx(mi,{model:r.model})}),s.jsx("div",{className:"text-xs text-muted",children:s.jsx(xi,{model:r.model})})]})]}),s.jsxs("div",{className:"flex items-center gap-4 flex-shrink-0",children:[s.jsx(rn,{className:"text-muted",size:"sm"}),s.jsx(d,{message:":count plays",values:{count:s.jsx(Oe,{value:r.value})}})]})]},r.model.id)),!t&&!n.length?s.jsxs("div",{className:"flex items-center gap-8 text-muted",children:[s.jsx(di,{size:"sm"}),s.jsx(d,{message:"No plays in selected timeframe."})]}):null]})}function ui({model:e,size:t,className:a}){const{pathname:n}=ue(),i=n.includes("/admin")?`/admin/${e.model_type}s/${e.id}/insights`:`/backstage/${e.model_type}s/${e.id}/insights`;switch(e.model_type){case"artist":return s.jsx(J,{to:i,children:s.jsx(ct,{artist:e,size:t,className:a})});case"album":return s.jsx(J,{to:i,children:s.jsx(Je,{album:e,size:t,className:a})});case"track":return s.jsx(J,{to:i,children:s.jsx(ws,{track:e,size:t,className:a})});case"user":return s.jsx(ln,{user:e,size:t,className:a})}}function mi({model:e}){switch(e.model_type){case"artist":return s.jsx(dt,{artist:e,target:"_blank"});case"album":return s.jsx(Ns,{album:e,target:"_blank"});case"track":return s.jsx(gt,{track:e,target:"_blank"});case"user":return e.id?s.jsx(Ma,{user:e,target:"_blank"}):s.jsx(u.Fragment,{children:e.display_name})}}function xi({model:e}){switch(e.model_type){case"artist":case"user":return null;case"album":case"track":return s.jsx(Xe,{artists:e.artists,target:"_blank"})}}function As(e){const a="flex flex-col lg:flex-row lg:items-center overflow-x-auto gap-12 md:gap-24 mb-12 md:mb-24",n=e.model,r=e.dateRange;return s.jsxs(u.Fragment,{children:[s.jsxs("div",{className:a,children:[s.jsx(Q,{metric:"plays",model:n,dateRange:r,children:({data:i})=>s.jsx(si,{className:"flex-auto",title:s.jsx(d,{message:"Plays"}),hideLegend:!0,description:s.jsx(d,{message:":count total plays",values:{count:s.jsx(Oe,{value:(i==null?void 0:i.report.plays.total)||0})}})})}),s.jsx(Q,{metric:"devices",model:n,dateRange:r,children:s.jsx(Bs,{title:s.jsx(d,{message:"Top devices"})})})]}),s.jsxs("div",{className:a,children:[e.showTracks&&s.jsx(Q,{metric:"tracks",model:n,dateRange:r,children:s.jsx(Ve,{title:s.jsx(d,{message:"Most played tracks"})})}),s.jsx(Q,{metric:"users",model:n,dateRange:r,children:s.jsx(Ve,{title:s.jsx(d,{message:"Top listeners"})})})]}),e.showArtistsAndAlbums&&s.jsxs("div",{className:a,children:[s.jsx(Q,{metric:"artists",model:n,dateRange:r,children:s.jsx(Ve,{title:s.jsx(d,{message:"Most played artists"})})}),s.jsx(Q,{metric:"albums",model:n,dateRange:r,children:s.jsx(Ve,{title:s.jsx(d,{message:"Most played albums"})})})]}),s.jsxs("div",{className:a,children:[s.jsx(Q,{metric:"locations",model:n,dateRange:r,children:s.jsx(ii,{className:"flex-auto w-1/2 lg:max-w-[740px]"})}),s.jsx(Q,{metric:"platforms",model:n,dateRange:r,children:s.jsx(Bs,{className:"max-w-500",title:s.jsx(d,{message:"Top platforms"})})})]})]})}function Q({children:e,metric:t,model:a,dateRange:n}){var m,p;const[r,i]=u.useState(!1),o=oi({metrics:[t],model:a,dateRange:n},{isEnabled:r}),l=typeof e=="function"?e(o):e,c=u.useRef(),f=u.useCallback(h=>{var x;if(h){const g=new IntersectionObserver(([b])=>{var v;b.isIntersecting&&(i(!0),(v=c.current)==null||v.disconnect(),c.current=void 0)},{threshold:.1});c.current=g,g.observe(h)}else c.current&&((x=c.current)==null||x.disconnect())},[]);return u.cloneElement(l,{data:(p=(m=o.data)==null?void 0:m.report)==null?void 0:p[t],isLoading:o.isLoading,contentRef:f})}function Ts({children:e,reportModel:t,title:a,isNested:n}){const[r,i]=u.useState(()=>bt[2].getRangeValue());return s.jsxs(u.Fragment,{children:[s.jsx(Ra,{children:s.jsx(d,{message:"Insights"})}),s.jsxs("div",{className:"h-full flex flex-col",children:[!n&&s.jsx(lt,{className:"flex-shrink-0",color:"bg",darkModeColor:"bg"}),s.jsx("div",{className:"overflow-y-auto flex-auto bg-cover relative",children:s.jsxs("div",{className:"min-h-full p-12 md:p-24 overflow-x-hidden max-w-[1600px] mx-auto flex flex-col",children:[s.jsxs("div",{className:"flex-auto",children:[s.jsxs("div",{className:"md:flex items-center justify-between gap-24 h-48 mt-14 mb-38",children:[a||s.jsx(he,{className:"max-w-320"}),s.jsx("div",{className:"flex-shrink-0 flex items-center justify-between gap-10 md:gap-24",children:s.jsx(Qr,{value:r,onChange:i})})]}),u.cloneElement(e,{dateRange:r,model:t})]}),!n&&s.jsx(ot,{})]})})]})]})}function $s({image:e,name:t,description:a}){return s.jsxs("div",{className:"flex items-center gap-10",children:[u.cloneElement(e,{size:"w-48 h-48",className:"rounded"}),s.jsxs("div",{children:[s.jsxs("h1",{className:"text-base whitespace-nowrap overflow-hidden overflow-ellipsis",children:["“",t,"“ ",s.jsx(d,{message:"insights"})]}),a&&s.jsx("div",{className:"text-muted text-sm",children:a})]})]})}function Ci({isNested:e}){const{artistId:t}=Ye(),{data:a}=pt({});return s.jsx(Ts,{reportModel:`artist=${t}`,title:(a==null?void 0:a.artist)&&s.jsx($s,{image:s.jsx(ct,{artist:a.artist}),name:s.jsx(dt,{artist:a.artist})}),isNested:e,children:s.jsx(As,{showTracks:!0})})}function Di({isNested:e}){const{albumId:t}=Ye(),{data:a}=ft({});return s.jsx(Ts,{reportModel:`album=${t}`,title:(a==null?void 0:a.album)&&s.jsx($s,{image:s.jsx(Je,{album:a.album}),name:s.jsx(Ns,{album:a.album}),description:s.jsx(Xe,{artists:a.album.artists})}),isNested:e,children:s.jsx(As,{showTracks:!0})})}function Si({isNested:e}){const{trackId:t}=Ye(),{data:a}=xt({});return s.jsx(Ts,{reportModel:`track=${t}`,title:(a==null?void 0:a.track)&&s.jsx($s,{image:s.jsx(ws,{track:a.track}),name:s.jsx(gt,{track:a.track}),description:s.jsx(Xe,{artists:a.track.artists})}),isNested:e,children:s.jsx(As,{})})}export{un as A,Bt as B,zn as C,kn as D,Di as E,Fn as F,ii as G,Ii as H,qn as I,Ci as J,yi as K,si as L,Bn as M,ni as N,Ar as O,Bs as P,Ft as Q,Qr as R,di as S,bi as U,kt as a,vt as b,ls as c,bt as d,St as e,It as f,Dt as g,gi as h,xe as i,_n as j,Hn as k,Se as l,Pe as m,Ct as n,At as o,wi as p,Ni as q,Ur as r,qt as s,pe as t,dn as u,As as v,ji as w,Si as x,ki as y,vi as z};
//# sourceMappingURL=backstage-track-insights-d08cc66a.js.map
